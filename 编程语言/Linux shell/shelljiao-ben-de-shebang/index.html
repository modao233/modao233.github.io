<!doctype html><html lang=zh-Hans-CN><head><title>modao's blog</title><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1.0,maximum-scale=1" name=viewport><meta content=noodp name=robots><link href=https://modao.site/style.css rel=stylesheet><link href=https://modao.site/color/green.css rel=stylesheet><link href=https://modao.site/color/background_dark.css rel=stylesheet><link href=https://modao.site/font-hack.css rel=stylesheet><script src="https://www.googletagmanager.com/gtag/js?id=G-N2WTGJE0M5" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-N2WTGJE0M5');</script><body><div class=container><header class=header><div class=header__inner><div class=header__logo><a style="text-decoration: none;" href=https://modao.site> <div class=logo>MODAO</div> </a></div></div><nav class=menu><ul class=menu__inner><li class=active><a href=https://modao.site>Home</a><li><a href=https://modao.site/tags>Tags</a><li><a href=https://modao.site/language>PL</a><li><a href=https://modao.site/books>Books</a><li><a href=https://modao.site/links>Links</a><li><a href=https://modao.site/friend>Friend</a></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href="https://modao.site/编程语言/Linux shell/shelljiao-ben-de-shebang/">Shebang</a></h1><div class=post-meta-inline><span class=post-date> 2021-01-08 </span></div><div class=post-content><p>维基词条：<a href=https://zh.wikipedia.org/wiki/Shebang>Shebang</a><h2 id=jian-jie>简介</h2><p>在计算领域中，<strong>Shebang</strong>（也称为Hashbang）是一个由井号和叹号构成的字符序列<code>#!</code>，其出现在文本文件的第一行的前两个字符。<p>在文件中存在Shebang的情况下，类Unix操作系统的<strong>程序加载器</strong>会分析Shebang后的内容，将这些内容作为<strong>解释器指令</strong>，并调用该指令，并将载有Shebang的文件路径作为该解释器的参数。<p>例如，以指令<code>#!/bin/sh</code>开头的文件在执行时会实际调用<code>/bin/sh</code>程序（通常是Bourne shell或兼容的shell，例如bash、dash等）来执行。这行内容也是shell脚本的标准起始行。<p>由于#符号在许多脚本语言中都是<strong>注释标识符</strong>，Shebang的内容会被这些脚本解释器自动忽略。 在#字符不是注释标识符的语言中，例如Scheme，解释器也可能忽略以#!开头的首行内容，以提供与Shebang的兼容性。<p>"Shebang"或者说"Hashbang"的名字有时也被当做Ajax应用程序中的分段标识符，用于浏览器的状态保存；Google网站站长中心提到，以叹号开头的分段标识符（即...url#!state...）会为Google的网页爬虫所索引。<h2 id=yu-fa>语法</h2><p>Shebang这一语法特性由<code>#!</code>开头，即井号和叹号。 在开头字符之后，可以有一个或数个空白字符，后接解释器的绝对路径，用于调用解释器。<p>在直接调用脚本时，调用者会利用Shebang提供的信息调用相应的解释器，从而使得脚本文件的调用方式与普通的可执行文件类似。<h2 id=li-zi>例子</h2><p>下面列出了一些典型的 shebang 解释器指令：<ul><li><code>#!/bin/sh</code>—使用<code>sh</code>，即Bourne shell或其它兼容shell执行脚本<li><code>#!/bin/csh</code>—使用<code>csh</code>，即C shell执行<li><code>#!/usr/bin/perl -w</code>—使用带警告的Perl执行<li><code>#!/usr/bin/python -O</code>—使用具有代码优化的Python执行<li><code>#!/usr/bin/php</code>—使用PHP的命令行解释器执行</ul><p>在许多系统上，/bin/sh软链接或硬链接到Bash，而/bin/csh则链接到tcsh，因此设定前面的解释器实际上是运行的与之兼容的，或改进的版本。<p>Shebang行也可以包含需要传递到解释器的特定选项（见下文的Perl例子）。然而，选项传递的方式随实现的不同而不同。<h2 id=yong-tu>用途</h2><p>解释器指令允许脚本和数据文件充当系统命令，无需在调用时由用户指定解释器，从而对用户和其它程序隐藏其实现细节。<p>假设<code>/usr/local/bin/foo</code>中有一以下行开头的Bourne shell脚本 <code>#!/bin/sh -x</code> 而它被如此调用（"$"是命令提示符） $ <code>foo bar</code> 该命令的输出等同于 $ <code>/bin/sh -x /usr/local/bin/foo bar</code> 除了argv[0]被设定为脚本的文件名，而非解释器的文件名外。<p>由于<code>sh</code>从其命令行指定的文件中读取命令，上面的命令就会执行<code>/usr/local/bin/foo</code>中的命令，同时，将<code>bar</code>作为<code>foo</code>命令的参数<code>$1</code>。<p>由于shebang开头的井号也是Bourne shell和许多其它解释性语言的注释符，因此在这些语言中，解释器指令本身会被解释器认为是单纯的注释而跳过。 然而，并不是每一种解释器都会自动忽略shebang行，例如对于下面的脚本，<code>cat</code>会把文件中的两行都输出到标准输出中。<pre style=background-color:#2b303b;color:#c0c5ce;><code><span>#!/bin/cat
</span><span>Hello world!
</span></code></pre><p>使用<code>#!/usr/bin/env 脚本解释器名称</code>是一种常见的在不同平台上都能正确找到解释器的办法。<p>Linux的操作系统的文件一般是UTF-8编码。如果脚本文件是以UTF-8的<code>BOM（0xEF 0xBB 0xBF）</code>开头的，那么exec函数将不会启动shebang指定的解释器来执行该脚本。因此，Linux的脚本文件不应在文件开头包含UTF-8的BOM。<h2 id=bin-bash>#!/bin/bash</h2><p><code>#!/bin/bash</code>是指此脚本使用<code>/bin/bash</code>来解释执行。<p>在脚本中，只有第一行的<code>#!/bin/bash</code>才起声明解释器作用，其余位置均为注释<p>脚本第一行的解释器路径一定要正确，不正确会报错（未验证）<p>常用的解释器注释<ul><li><code>#!/bin/bash</code><li><code>#!/bin/sh</code><li>不写：脚本会默认当前用户登录的shell，为脚本解释器<li>其他</ul><p>脚本里声明解释器类型和运行时指定解释器效果相同<p><code>#!/bin/sh</code>一般设成<code>#!/bin/bash</code>的软链接，在一般的linux系统当中（如redhat），使用sh调用执行脚本相当于打开了bash的POSIX标准模式，也就是说 /bin/sh 相当于 /bin/bash --posix<p><code>#!/bin/bash</code>和<code>#!/bin/bash --posix</code>的区别<ul><li>不开启posix时，运行出错会报错，但继续执行后续<li>开启posix时，运行出错会报错，不继续执行后续</ul></div></div></div><footer class=footer__poweredby><p class=caption>© 2022 All Rights Reserved modao::rustacean@aliyun.com<p class=caption>© Powered by <a href=https://www.getzola.org/>Zola</a><p class=caption>© Theme: <a href=https://github.com/pawroman/zola-theme-terminimal/>Terminimal</a> by pawroman<p class=caption><a href=https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh rel=license>自由转载-非商用-非衍生-保持署名</a></footer></div>