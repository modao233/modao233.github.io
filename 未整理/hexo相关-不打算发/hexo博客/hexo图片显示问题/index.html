<!DOCTYPE html>
<html>
<!-- html页面布局的head -->

<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	<title>
		modao
	</title>

	<!-- 百度统计代码 -->
	<script>
		var _hmt = _hmt || [];
		(function () {
			var hm = document.createElement("script");
			hm.src = "https://hm.baidu.com/hm.js?902dc461fe0d25f09e74e0d04677b6d8";
			var s = document.getElementsByTagName("script")[0];
			s.parentNode.insertBefore(hm, s);
		})();
	</script>

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-N2WTGJE0M5"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag() { dataLayer.push(arguments); }
		gtag('js', new Date());

		gtag('config', 'G-N2WTGJE0M5');
	</script>
<meta name="generator" content="Hexo 5.4.0"></head>

  <body>

    <!-- 文章详情页模板 -->

<!-- 主页标题栏 -->

<link rel="stylesheet" href="/css/navigatebar.css">


<header class="header">
	<div class="topbar">
		<div class="topbar-button topbar-mine">
			<a href="/">
				modao
			</a>
		</div>
		
			<div class="topbar-button">
				<a href="/">
					Home
				</a>
			</div>
		
			<div class="topbar-button">
				<a href="/categories">
					Categories
				</a>
			</div>
		
			<div class="topbar-button">
				<a href="/links">
					Friends
				</a>
			</div>
		
			<div class="topbar-button">
				<a href="/sites">
					Sites
				</a>
			</div>
		
			<div class="topbar-button">
				<a href="/stars">
					Stars
				</a>
			</div>
		

	</div>
	<div class="slogan">
		「生活可以更简单, 欢迎来到我的开源世界」
	</div>
</header>


<link rel="stylesheet" href="/css/font.css">


<link rel="stylesheet" href="/css/post.css" media="screen and (min-width: 600px)">


<link rel="stylesheet" href="/css/post_mobile.css" media="screen and (max-width: 600px)">


<link rel="stylesheet" href="/css/highlight.css">




<div class="toc">
<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%8F%92%E4%BB%B6"><span class="toc-text">安装插件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%96%87%E4%BB%B6"><span class="toc-text">修改文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE"><span class="toc-text">修改配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E5%B0%BE%E8%A1%A5%E5%85%85"><span class="toc-text">结尾补充</span></a></li></ol>
</div>

<div class="content-area">
	<div class="title">
		hexo图片显示问题
	</div>
	
	<div class="page-date">
		2020-06-03
	</div>
	
	<div class="category-area">
		
			 
				「
				<div class="category">
					<a href="/categories/hexo">hexo</a>
				
				</div>
				」
			
		
	</div>
	
	<div class="content">
		<p>解决hexo使用本地图片的上传、显示问题</p>
<span id="more"></span>

<h2 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h2><p>hexo-asset-image，安装了这个插件后，可以在安装md的语法插入图片（使用相对路径），可以让图片所在的目录被当作资源目录上传</p>
<p><strong>安装0.0.5版本的hexo-asset-image插件：</strong>(网上教程说得用这个)</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">npm install https://github.com/CodeFalling/hexo-asset-image --save <br></code></pre></td></tr></table></figure>

<p><strong>安装1.0.0版本的hexo-asset-image插件:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">npm install hexo-asset-image --save<br></code></pre></td></tr></table></figure>

<h2 id="修改文件"><a href="#修改文件" class="headerlink" title="修改文件"></a>修改文件</h2><p>网上教程还说需要修改/node_modules/hexo-asset-image/index.js，将内容替换成以下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext"><br>//著作权归作者所有。<br>//商业转载请联系作者获得授权，非商业转载请注明出处。<br>//作者：QAQu<br>//链接：https://www.qaqu.net/2020-1-12-Hexo4.2%E5%9B%BE%E7%89%87%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98/<br>//来源：QAQu’s Blog<br><br>&#x27;use strict&#x27;;<br>var cheerio = require(&#x27;cheerio&#x27;);<br><br>// http://stackoverflow.com/questions/14480345/how-to-get-the-nth-occurrence-in-a-string<br>function getPosition(str, m, i) &#123;<br>  return str.split(m, i).join(m).length;<br>&#125;<br><br>var version = String(hexo.version).split(&#x27;.&#x27;);<br>hexo.extend.filter.register(&#x27;after_post_render&#x27;, function(data)&#123;<br>  var config = hexo.config;<br>  if(config.post_asset_folder)&#123;<br>        var link = data.permalink;<br>    if(version.length &gt; 0 &amp;&amp; Number(version[0]) == 3)<br>       var beginPos = getPosition(link, &#x27;/&#x27;, 1) + 1;<br>    else<br>       var beginPos = getPosition(link, &#x27;/&#x27;, 3) + 1;<br>    // In hexo 3.1.1, the permalink of &quot;about&quot; page is like &quot;.../about/index.html&quot;.<br>    var endPos = link.lastIndexOf(&#x27;/&#x27;) + 1;<br>    link = link.substring(beginPos, endPos);<br><br>    var toprocess = [&#x27;excerpt&#x27;, &#x27;more&#x27;, &#x27;content&#x27;];<br>    for(var i = 0; i &lt; toprocess.length; i++)&#123;<br>      var key = toprocess[i];<br> <br>      var $ = cheerio.load(data[key], &#123;<br>        ignoreWhitespace: false,<br>        xmlMode: false,<br>        lowerCaseTags: false,<br>        decodeEntities: false<br>      &#125;);<br><br>      $(&#x27;img&#x27;).each(function()&#123;<br>        if ($(this).attr(&#x27;src&#x27;))&#123;<br>            // For windows style path, we replace &#x27;\&#x27; to &#x27;/&#x27;.<br>            var src = $(this).attr(&#x27;src&#x27;).replace(&#x27;\\&#x27;, &#x27;/&#x27;);<br>            if(!/http[s]*.*|\/\/.*/.test(src) &amp;&amp;<br>               !/^\s*\//.test(src)) &#123;<br>              // For &quot;about&quot; page, the first part of &quot;src&quot; can&#x27;t be removed.<br>              // In addition, to support multi-level local directory.<br>              var linkArray = link.split(&#x27;/&#x27;).filter(function(elem)&#123;<br>                return elem != &#x27;&#x27;;<br>              &#125;);<br>              var srcArray = src.split(&#x27;/&#x27;).filter(function(elem)&#123;<br>                return elem != &#x27;&#x27; &amp;&amp; elem != &#x27;.&#x27;;<br>              &#125;);<br>              if(srcArray.length &gt; 1)<br>                srcArray.shift();<br>              src = srcArray.join(&#x27;/&#x27;);<br>              $(this).attr(&#x27;src&#x27;, config.root + link + src);<br>              console.info&amp;&amp;console.info(&quot;update link as:--&gt;&quot;+config.root + link + src);<br>            &#125;<br>        &#125;else&#123;<br>            console.info&amp;&amp;console.info(&quot;no src attr, skipped...&quot;);<br>            console.info&amp;&amp;console.info($(this));<br>        &#125;<br>      &#125;);<br>      data[key] = $.html();<br>    &#125;<br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></figure>

<h2 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h2><p>接着修改__config.yml文件，修改的是站点配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">post_asset_folder: true<br></code></pre></td></tr></table></figure>

<h2 id="结尾补充"><a href="#结尾补充" class="headerlink" title="结尾补充"></a>结尾补充</h2><ol>
<li><p><strong>插入图片就和正常markdown语法一样，然后使用相对目录就行</strong></p>
<p> <img src="/hexo%E5%9B%BE%E7%89%87%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98/image-20200603185756079.png" alt="image-20200603185756079"></p>
</li>
<li><p><strong>使用Typora可以把偏好设置如图设置</strong></p>
<p> <img src="/hexo%E5%9B%BE%E7%89%87%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98/image-20200603185929189.png" alt="image-20200603185929189"></p>
</li>
<li><p>一些自己发现的坑：</p>
<ol>
<li><p> <strong>如果图片文件夹命名有空格的话，相对目录中的文件夹名应该使用：从左边数至第一个空格处，不包括空格</strong></p>
</li>
<li><p><strong>文档名必须和资源文件夹（也就是图片所在文件夹）名相同</strong></p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">文件名可以是：     a-b c.md<br>文件夹是也是：     a-b c<br>描述图片相对路径是：./a-b/1.jpg<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>

	</div>
</div>
<!-- 返回顶部模块 -->
<div id="totop" style="position:fixed;bottom:150px;right:50px;cursor: pointer;font-size:26px;background-color:#8590a6">
	<a title="返回顶部" style="color:#04fa9f"><⇧></a>
</div>
<script src="/js/totop.js"></script>

  </body>

</html>