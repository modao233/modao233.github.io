<!DOCTYPE html>
<html>
<!-- html页面布局的head -->

<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	<title>
		modao
	</title>

	<!-- 百度统计代码 -->
	<script>
		var _hmt = _hmt || [];
		(function () {
			var hm = document.createElement("script");
			hm.src = "https://hm.baidu.com/hm.js?902dc461fe0d25f09e74e0d04677b6d8";
			var s = document.getElementsByTagName("script")[0];
			s.parentNode.insertBefore(hm, s);
		})();
	</script>

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-N2WTGJE0M5"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag() { dataLayer.push(arguments); }
		gtag('js', new Date());

		gtag('config', 'G-N2WTGJE0M5');
	</script>
<meta name="generator" content="Hexo 5.4.0"></head>

  <body>

    <!-- 文章详情页模板 -->

<!-- 主页标题栏 -->

<link rel="stylesheet" href="/css/navigatebar.css">


<header class="header">
	<div class="topbar">
		<div class="topbar-button topbar-mine">
			<a href="/">
				modao
			</a>
		</div>
		
			<div class="topbar-button">
				<a href="/">
					Home
				</a>
			</div>
		
			<div class="topbar-button">
				<a href="/categories">
					Categories
				</a>
			</div>
		
			<div class="topbar-button">
				<a href="/links">
					Friends
				</a>
			</div>
		
			<div class="topbar-button">
				<a href="/sites">
					Sites
				</a>
			</div>
		
			<div class="topbar-button">
				<a href="/stars">
					Stars
				</a>
			</div>
		

	</div>
	<div class="slogan">
		「工作日还有多少天，休息日还剩几小时」
	</div>
</header>


<link rel="stylesheet" href="/css/font.css">


<link rel="stylesheet" href="/css/post.css" media="screen and (min-width: 600px)">


<link rel="stylesheet" href="/css/post_mobile.css" media="screen and (max-width: 600px)">


<link rel="stylesheet" href="/css/highlight.css">




<div class="toc">
<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Project-V"><span class="toc-text">Project V</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85V2Ray%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-text">安装V2Ray客户端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AESocks%E4%BB%A3%E7%90%86"><span class="toc-text">配置Socks代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEshell%E4%BB%A3%E7%90%86"><span class="toc-text">配置shell代理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%B4%E6%97%B6%E4%BB%A3%E7%90%86"><span class="toc-text">临时代理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%BF%E6%9C%9F%E4%BB%A3%E7%90%86"><span class="toc-text">长期代理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEPAC"><span class="toc-text">配置PAC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90PAC"><span class="toc-text">生成PAC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Firefox-PAC%E4%BB%A3%E7%90%86%E8%AE%BE%E7%BD%AE"><span class="toc-text">Firefox PAC代理设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9FPAC%E4%BB%A3%E7%90%86%E8%AE%BE%E7%BD%AE"><span class="toc-text">系统PAC代理设置</span></a></li></ol></li></ol>
</div>

<div class="content-area">
	<div class="title">
		(转载)在Linux/Manjaro中使用V2Ray
	</div>
	
	<div class="page-date">
		2020-11-24
	</div>
	
	<div class="category-area">
		
			 
				「
				<div class="category">
					<a href="/categories/Proxy">Proxy</a>
				
				</div>
				」
			
		
	</div>
	
	<div class="content">
		<p><a target="_blank" rel="noopener" href="https://www.wannaexpresso.com/2020/02/23/manjaro-v2ray/">在Linux/Manjaro中使用V2Ray - DOTIN13’S BLOG (wannaexpresso.com)</a></p>
<span id="more"></span>

<h2 id="Project-V"><a href="#Project-V" class="headerlink" title="Project V"></a>Project V</h2><p>要了解 <code>V2Ray</code> 就必须要知道 <a target="_blank" rel="noopener" href="https://github.com/v2ray">Project V</a>，根据官方说法：<code>Project V</code> 是一个工具集合，它可以帮助你打造专属的基础<strong>通信网络</strong>，<strong>Project V 的核心工具称为 V2Ray</strong>，其主要负责网络协议和功能的实现，与其它 <code>Project V</code> 通信，<code>V2Ray</code> 可以单独运行，也可以和其它工具配合，以提供简便的操作流程。</p>
<p>相对于<code>shadowsocksr</code>来说，它有以下几个优势：</p>
<ul>
<li>  <strong>多入口多出口</strong>: 一个 <code>V2Ray</code> 进程可并发支持多个入站和出站协议，每个协议可独立工作</li>
<li>  <strong>可定制化路由</strong>: 入站流量可按配置由不同的出口发出。轻松实现按区域或按域名分流，以达到最优的网络性能</li>
<li>  <strong>多协议支持</strong>: V2Ray 可同时支持多个协议，包括 <code>Socks</code>、<code>HTTP</code>、<code>Shadowsocks</code>、<code>VMess</code> 等</li>
<li>  <strong>隐蔽性</strong>: V2Ray 的节点可以伪装成正常的网站（HTTPS），将其流量与正常的网页流量混淆，以避开第三方干扰</li>
<li>  <strong>反向代理</strong>: 通用的反向代理支持，可实现内网穿透功能</li>
<li>  <strong>多平台支持</strong>: 原生支持所有常见平台，如 Windows、Mac OS、Linux，并已有第三方支持移动平台</li>
</ul>
<h2 id="安装V2Ray客户端"><a href="#安装V2Ray客户端" class="headerlink" title="安装V2Ray客户端"></a>安装V2Ray客户端</h2><p>客户端软件在<a target="_blank" rel="noopener" href="https://github.com/v2ray/v2ray-core/releases">发布页</a>，根据你需要的系统下载匹配型号的安装包，我这里以我的系统为例子，其他系统请自行参照<a target="_blank" rel="noopener" href="https://www.wannaexpresso.com/2020/02/23/manjaro-v2ray/">官方文档</a>配置。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">sudo pacman -S v2ray    #ArchLinux/Manjaro安装v2ray<br></code></pre></td></tr></table></figure>

<p>配置上可以替换<code>/etc/v2ray/config.json</code>文件，参照以下模板自行修改参数即可，注意修改各注释处；或者可以使用<a target="_blank" rel="noopener" href="https://intmainreturn0.com/v2ray-config-gen/">配置生成器</a>。</p>
<p>config示例：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">&#123;<br>  &quot;inbounds&quot;: [<br>    &#123;<br>      &quot;port&quot;: 1080, // 监听端口<br>      &quot;protocol&quot;: &quot;socks&quot;, // 入口协议为 SOCKS 5<br>      &quot;sniffing&quot;: &#123;<br>        &quot;enabled&quot;: true,<br>        &quot;destOverride&quot;: [&quot;http&quot;, &quot;tls&quot;]<br>      &#125;,<br>      &quot;settings&quot;: &#123;<br>        &quot;auth&quot;: &quot;noauth&quot;  //socks的认证设置，noauth 代表不认证，由于 socks 通常在客户端使用，所以这里不认证<br>      &#125;<br>    &#125;<br>  ],<br>  &quot;outbounds&quot;: [<br>    &#123;<br>      &quot;protocol&quot;: &quot;vmess&quot;, // 出口协议<br>      &quot;settings&quot;: &#123;<br>        &quot;vnext&quot;: [<br>          &#123;<br>            &quot;address&quot;: &quot;serveraddr.com&quot;, // 服务器地址，请修改为你自己的服务器 IP 或域名<br>            &quot;port&quot;: 16823,  // 服务器端口<br>            &quot;users&quot;: [<br>              &#123;<br>                &quot;id&quot;: &quot;b831381d-6324-4d53-ad4f-8cda48b30811&quot;,  // 用户 ID，必须与服务器端配置相同<br>                &quot;alterId&quot;: 64 // 此处的值也应当与服务器相同<br>              &#125;<br>            ]<br>          &#125;<br>        ]<br>      &#125;<br>    &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure>

<p><code>V2Ray</code>支持配置多个服务器，那么多个服务器配置的时候，它其实是轮询访问的，也就是说第一个数据包走第一个服务器，第二个数据包走第二个服务器，而不是我们一般认为的第一个服务器被墙了就自动切换到第二个服务器，然后继续传输。</p>
<p>p&gt;路由规则参照 <a target="_blank" rel="noopener" href="https://github.com/v2ray/domain-list-community">domain-list-community</a> 域名列表，如果该项目中有一整套 <code>google</code> 顶级域名及其子域名，则用 <code>geosite</code> 写成 <code>geosite:google</code> ，如果是普通网站，则使用 <code>domain</code> 写成 <code>domain:google.com</code></p>
<p>使用<code>v2ray</code>自带了一个检查工具<code>v2ray -test</code>检查<code>json</code>文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">v2ray -test -config /etc/v2ray/config.json  #检查json<br>V2Ray 4.18.0 (Po) 20190228<br>A unified platform for anti-censorship.<br>Configuration OK.<br></code></pre></td></tr></table></figure>

<p>显示<code>OK</code>就表示没问题了，可以开启本机的开机自启服务</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">systemctl enable v2ray  #开机自启v2ray<br>systemctl start v2ray   #启动v2ray<br></code></pre></td></tr></table></figure>

<h2 id="配置Socks代理"><a href="#配置Socks代理" class="headerlink" title="配置Socks代理"></a>配置Socks代理</h2><p>打开系统设置，进入网络设置，配置如下图：</p>
<p><img src="v2ray-manual-socks.png" alt="img"><em>System Manual Proxy</em></p>
<p>如果仅需要浏览器代理，可以下载<code>SwitchyOmega</code>浏览器插件，最简配置如下：</p>
<p><img src="switchyomega.png" alt="img"><em>SwitchyOmega Settings</em></p>
<h2 id="配置shell代理"><a href="#配置shell代理" class="headerlink" title="配置shell代理"></a>配置shell代理</h2><p>为了解决终端下载被墙服务器的安装包失败的问题，可以考虑代理终端。</p>
<h3 id="临时代理"><a href="#临时代理" class="headerlink" title="临时代理"></a>临时代理</h3><p>只需要http代理则输入命令<code>export http_proxy=http://proxyAddress:port</code>； 全部协议代理则输入命令<code>export ALL_PROXY=http://proxyAddress:port</code>。 临时代理仅对当前环境有效，重启即失效。</p>
<h3 id="长期代理"><a href="#长期代理" class="headerlink" title="长期代理"></a>长期代理</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">sudo gedit ~/.bashrc    #编辑.bashrc文件<br></code></pre></td></tr></table></figure>

<p>在最后追加以下配置。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">export http_proxy=&quot;http://localhost:port&quot;<br>export https_proxy=&quot;http://localhost:port&quot;<br></code></pre></td></tr></table></figure>

<p><code>source ~/.bashrc</code>或者重启终端后生效</p>
<h2 id="配置PAC"><a href="#配置PAC" class="headerlink" title="配置PAC"></a>配置PAC</h2><h3 id="生成PAC"><a href="#生成PAC" class="headerlink" title="生成PAC"></a>生成PAC</h3><p><code>PAC</code>代理需要生成一个<code>.pac</code>的文件，首先本机安装<code>pip</code>工具</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">sudo pacman -S python-pip       #安装pip<br>pip -V      #查看pip版本<br>#-------------------------输出----------------------------<br>pip 19.0.3 from /usr/lib/python3.7/site-packages/pip (python 3.7)<br>sudo pip install genpac     #使用pip安装genpac，需要root权限<br>#-------------------------输出----------------------------<br>Collecting genpac<br>  Downloading https://files.pythonhosted.org/packages/48/fb/b8f9cce57c4ea856e7dd1f9fb917df2896d7e62d43c50ed1af2e50a4e57d/genpac-2.1.0.tar.gz (102kB)<br>     |████████████████████████████████| 112kB 111kB/s <br>Installing collected packages: genpac<br>  Running setup.py install for genpac ... done<br>Successfully installed genpac-2.1.0<br></code></pre></td></tr></table></figure>

<p>最后执行以下命令，会生成一个auto.pac文件，无输出结果表示执行成功</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">genpac --format=pac -o auto.pac --pac-proxy=&quot;SOCKS5 127.0.0.1:1080&quot;<br></code></pre></td></tr></table></figure>

<h3 id="Firefox-PAC代理设置"><a href="#Firefox-PAC代理设置" class="headerlink" title="Firefox PAC代理设置"></a>Firefox PAC代理设置</h3><p>PAC文件的绝对路径为<code>file:///etc/v2ray/auto.pac</code>，如下图</p>
<p><img src="firefox-pac.png" alt="img"><em>Firefox PAC Manual Proxy</em></p>
<h3 id="系统PAC代理设置"><a href="#系统PAC代理设置" class="headerlink" title="系统PAC代理设置"></a>系统PAC代理设置</h3><p>以<code>gnome</code>桌面为例，PAC文件的绝对路径为<code>file:///etc/v2ray/auto.pac</code>；</p>
<p><img src="v2ray-auto-pac.png" alt="img"><em>PAC Automatic Proxy</em></p>
<p>全局代理也可以通过以下命令来设置:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">gsettings set org.gnome.system.proxy autoconfig-url file:///etc/v2ray/auto.pac<br>gsettings set org.gnome.system.proxy mode &#x27;auto&#x27;<br><br>gsettings set org.gnome.system.proxy.socks host &#x27;127.0.0.1&#x27;<br>gsettings set org.gnome.system.proxy.socks port 1088<br></code></pre></td></tr></table></figure>

<p>转引自<a target="_blank" rel="noopener" href="https://www.teaper.dev/2019/06/02/v2ray/%EF%BC%8C%E6%9C%89%E4%BF%AE%E6%94%B9%E3%80%82">https://www.teaper.dev/2019/06/02/v2ray/，有修改。</a></p>

	</div>
</div>
<!-- 返回顶部模块 -->
<div id="totop" style="position:fixed;bottom:150px;right:50px;cursor: pointer;font-size:26px;background-color:#8590a6">
	<a title="返回顶部" style="color:#04fa9f"><⇧></a>
</div>
<script src="/js/totop.js"></script>

  </body>

</html>