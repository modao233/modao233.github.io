<!doctype html><html lang=zh-Hans-CN><head><title>modao's blog</title><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1.0,maximum-scale=1" name=viewport><meta content=noodp name=robots><link href=https://modao.site/style.css rel=stylesheet><link href=https://modao.site/color/green.css rel=stylesheet><link href=https://modao.site/color/background_dark.css rel=stylesheet><link href=https://modao.site/font-hack.css rel=stylesheet><script src="https://www.googletagmanager.com/gtag/js?id=G-N2WTGJE0M5" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-N2WTGJE0M5');</script><body><div class=container><header class=header><div class=header__inner><div class=header__logo><a style="text-decoration: none;" href=https://modao.site> <div class=logo>MODAO</div> </a></div></div><nav class=menu><ul class=menu__inner><li class=active><a href=https://modao.site>Home</a><li><a href=https://modao.site/tags>Tags</a><li><a href=https://modao.site/language>PL</a><li><a href=https://modao.site/books>Books</a><li><a href=https://modao.site/links>Links</a><li><a href=https://modao.site/friend>Friend</a></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=https://modao.site/Linux/linuxqi-dong-liu-cheng/>Linux启动流程</a></h1><div class=post-meta-inline><span class=post-date> 2021-05-30 </span></div><span class=post-tags-inline> :: tags:  <a class=post-tag href=https://modao.site/tags/linux/>#Linux</a></span><div class=post-content><p>Linux启动流程<h2 id=liu-cheng-jian-jie>流程简介</h2><p>操作系统启动过程分四阶段：<ol><li>BIOS启动。CPU通电后PC计数器初始化为一个特定的内存地址，指向ROM中BIOS的起始地址，由BIOS执行硬件的基本初始化，最先找到的设备的最开始的几个扇区将被加载到内存，BIOS执行其中的初始化代码并将系统控制权转交引导加载程序。<li>引导加载程序。由BIOS启动，负责将系统内核映像和initrd映像加载到内存并转交控制权。<li>initrd 或 initramfs 系统。在内存中运行系统内核和根文件系统，init 程序是内存中的根文件系统上执行的第一个程序，这个程序在用户空间把内核初始化，并把控制权交给下一阶段。<li>实际系统。根文件系统将由内存切换到实际的硬盘文件系统上，init 程序是系统执行的第一个程序（PID=1），它启动其它各种程序以完成主引导流程。</ol><h2 id=xiang-guan-zhi-shi>相关知识</h2><p>initrd 映像是根文件系统映像：<ul><li>initrd是指一个临时文件系统，它在启动阶段被Linux内核调用<li>initrd主要用于当“根”文件系统被挂载之前，进行准备工作</ul><p>initramfs是initrd的替代品：<ul><li>initrd是一个被加载的块设备，内部有ext2一类文件系统的存在，于是由于Linux内核的缓存机制，其中的内容还会被缓存到内存上，造成一定的内存空间浪费<li>initramfs本身就是一个tmpfs的RAM disk，拥有最小化的设计，绕过了缓存机制，也消除了多余的内存占用。initramfs的生成方式也远比initrd简单。</ul><p>PC上运行的Linux系统，它启动后从BIOS开始，进入bootloader，有bootloader加载内核，进入内核初始化。内核启动的最后一步就是创建一个pid为1的init进程。这是系统的第一个进程，它负责生产其他所有用户进程。<p>init程序流派：<ul><li>SysV：shell脚本控制<li>systemd：目前主流，但饱受争议<li>openrc：容易上手<li>upstart<li>busybox：嵌入式系统上使用</ul><p>initramfs里有init<p>rootfs里也有init<p>initrd、initramfs用来初始化 /dev/proc/sys<p>类似chroot前三大步骤，格式不同<p>内核中有三种 chroot<ol><li>切换root目录<li>chroot：换一个用户空间，实际没有切换根目录<li>切换进程根目录</ol><p>switch_chroot是initramfs的最后一个步骤<p>initramfs和initrd都是在切换根目录<h2 id=can-kao>参考</h2><ul><li><p><a href=https://blog.csdn.net/rikeyone/article/details/51525269>嵌入式linux init系统（busybox init）</a></p><li><p><a href=http://www.voidcn.com/article/p-ziomedvd-bnm.html>现代 Linux 的五大初始化系统（1992-2015）</a></p></ul></div></div></div><footer class=footer__poweredby><p class=caption>© 2022 All Rights Reserved modao::rustacean@aliyun.com<p class=caption>© Powered by <a href=https://www.getzola.org/>Zola</a><p class=caption>© Theme: <a href=https://github.com/pawroman/zola-theme-terminimal/>Terminimal</a> by pawroman<p class=caption><a href=https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh rel=license>自由转载-非商用-非衍生-保持署名</a></footer></div>