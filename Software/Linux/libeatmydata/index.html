<!doctype html><html lang=zh-Hans-CN><head><title>modao's blog</title><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1.0,maximum-scale=1" name=viewport><meta content=noodp name=robots><link href=https://modao.site/style.css rel=stylesheet><link href=https://modao.site/color/green.css rel=stylesheet><link href=https://modao.site/color/background_dark.css rel=stylesheet><link href=https://modao.site/font-hack.css rel=stylesheet><body><div class=container><header class=header><div class=header__inner><div class=header__logo><a style="text-decoration: none;" href=https://modao.site> <div class=logo>MODAO</div> </a></div></div><nav class=menu><ul class=menu__inner><li class=active><a href=https://modao.site>Home</a><li><a href=https://modao.site/tags>Tags</a><li><a href=https://modao.site/language>Programming-Language</a><li><a href=https://modao.site/books>Books</a><li><a href=https://modao.site/links>Links</a><li><a href=https://modao.site/friend>Friend</a></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=https://modao.site/Software/Linux/libeatmydata/>(转载)libeatmydata</a></h1><div class=post-meta-inline><span class=post-date> 2020-12-28 </span></div><span class=post-tags-inline> :: tags:  <a class=post-tag href=https://modao.site/tags/software/>#Software</a>  <a class=post-tag href=https://modao.site/tags/linux/>#Linux</a></span><div class=post-content><p>原文：https://www.flamingspork.com/projects/libeatmydata/<p>libeatmydata is a small LD_PRELOAD library designed to (transparently) disable fsync (and friends, like open(O_SYNC)). This has two side-effects: making software that writes data safely to disk a lot quicker and making this software no longer crash safe.<p><strong>DO NOT use libeatmydata on software where you care about what it stores</strong>. It's called lib<strong>EAT-MY-DATA</strong> for a <strong>reason</strong>.<h2 id=source>Source</h2><p>I've recently been migrating things over to git from the old BZR repository.<p>Git repositories are on <a href=https://code.launchpad.net/libeatmydata>launchpad</a> and <a href=https://github.com/stewartsmith/libeatmydata>github</a><p>Grab the latest by just doing <code>git clone https://github.com/stewartsmith/libeatmydata.git</code> - although most Linux distros package libeatmydata as eatmydata<p>Download: The <a href=https://launchpad.net/libeatmydata/+download>launchpad download page</a> has all the latest libeatmydata downloads.<p>You can also download the source tarball from here: <a href=https://www.flamingspork.com/projects/libeatmydata/libeatmydata-105.tar.gz>libeatmydata-105.tar.gz</a> and GPG signature: <a href=https://www.flamingspork.com/projects/libeatmydata/libeatmydata-105.tar.gz.asc>libeatmydata-105.tar.gz.asc</a>.<h2 id=install>Install</h2><p>If installing from source, do the following:<ol><li><code>git clone https://github.com/stewartsmith/libeatmydata.git</code> (or extract from source tarball)<li><code>cd libeatmydata</code><li><code>autoreconf -i</code> (if building from git only)<li><code>./configure</code><li><code>make</code><li><code>make check</code><li><code>sudo make install</code></ol><h2 id=using>Using</h2><p>Once libeatmydata is installed (either from a package or from source like above, simply run the eatmydata wrapper script:<ul><li><code>eatmydata foo</code></ul><h2 id=platform-support>Platform Support</h2><p>I use it primarily on Linux. Others have reported success on MacOS X, OpenSolaris, Solaris, Debian GNU/kFreeBSD. Patches welcome!<h2 id=contributing>Contributing</h2><p>You can email me directly with patches. Development is hosted on <a href=http://www.launchpad.net/libeatmydata>launchpad</a> and has been transitioning to <a href=https://github.com/stewartsmith/libeatmydata>github</a>.<h2 id=performance-improvements>Performance Improvements</h2><p>Running mysql-test-run --do-test=innodb without/with libeatmydata:<pre style=background-color:#2b303b;color:#c0c5ce;><code><span>TEST                           RESULT         TIME (ms)   TIME (with libeatmydata)
</span><span>-------------------------------------------------------------------------------+++
</span><span>
</span><span>main.innodb-lock               [ pass ]           4523     4323
</span><span>main.innodb-replace            [ pass ]            102       56
</span><span>main.innodb-ucs2               [ pass ]           5786     1084
</span><span>main.innodb                    [ pass ]          78306    24900
</span><span>main.innodb_gis                [ pass ]           2647     1544
</span><span>main.innodb_mysql              [ pass ]          86810    68579
</span><span>main.innodb_notembedded        [ pass ]            198      150
</span><span>main.innodb_timeout_rollback   [ pass ]           2990     2750
</span><span>main.innodb_trx_weight         [ pass ]           1608      841
</span><span>------------------------------------------------------------+++
</span><span>Stopping All Servers
</span><span>All 9 tests were successful.
</span><span>The servers were restarted 7 times
</span><span>
</span><span>WITHOUT: Spent 182.97 seconds actually executing testcases
</span><span>WITH   : Spent 104.227 seconds actually executing testcases
</span><span>
</span><span>WITHOUT:               WITH:
</span><span>real    3m36.053s      real    2m10.610s
</span><span>user    0m42.323s      user    0m41.939s
</span><span>sys     0m2.844s       sys     0m2.356s
</span></code></pre><p>This saves us about a third of the total runtime!</div></div></div><footer class=footer__poweredby><p class=caption>© 2022 All Rights Reserved modao::rustacean@aliyun.com<p class=caption>© Powered by <a href=https://www.getzola.org/>Zola</a><p class=caption>© Theme: <a href=https://github.com/pawroman/zola-theme-terminimal/>Terminimal</a> by pawroman<p class=caption><a href=https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh rel=license>自由转载-非商用-非衍生-保持署名</a></footer></div>