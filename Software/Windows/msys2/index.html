<!DOCTYPE html>
<html>
  <head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	<title>modao</title>
	
	<script type="text/javascript" charset="utf-8">
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "https://hm.baidu.com/hm.js?36479f1e15841da95f9e92a25b010d23";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>


<meta name="generator" content="Hexo 5.4.0"></head>
  <body>
	
      
<link rel="stylesheet" href="/css/navigatebar.css">


<div class="navigatebar">
	<div class="navigatebar-button navigatebar-mine">
    <a href="/">modao</a>
	</div>
	
	
        <div class="navigatebar-button">
          <a href="/">Home</a>
        </div>
	
        <div class="navigatebar-button">
          <a href="/categories">Categories</a>
        </div>
	
        <div class="navigatebar-button">
          <a href="/links">Friends</a>
        </div>
	
        <div class="navigatebar-button">
          <a href="/sites">Sites</a>
        </div>
	
        <div class="navigatebar-button">
          <a href="/stars">Stars</a>
        </div>
	
</div>


<link rel="stylesheet" href="/css/font.css">


<link rel="stylesheet" href="/css/post.css" media="screen and (min-width: 600px)">


<link rel="stylesheet" href="/css/post_mobile.css" media="screen and (max-width: 600px)">


<link rel="stylesheet" href="/css/highlight.css">


<div class="toc">
<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%9B%BD%E5%86%85%E9%95%9C%E5%83%8F"><span class="toc-text">配置国内镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#msys2%E7%B3%BB%E7%BB%9F%E6%9B%B4%E6%96%B0"><span class="toc-text">msys2系统更新</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%86%E9%92%A5%E5%A4%B1%E6%95%88%E9%97%AE%E9%A2%98"><span class="toc-text">密钥失效问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E5%8E%9F%E5%9B%A0"><span class="toc-text">错误原因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D%E5%8A%9E%E6%B3%95%EF%BC%9A"><span class="toc-text">修复办法：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-text">参考文章</span></a></li></ol>
</div>

<div class="content-area">
	<div class="title">
		msys2配置
	</div>
	
	<div class="page-date">
		2020-08-08
	</div>
	
	<div class="category-area">
		
			 
				「
				<div class="category">
					<a href="/categories/Software">Software</a>
				
				</div>
				」
			
		
	</div>
	
	<div class="content">
		<p>msys2配置</p>
<span id="more"></span>

<h2 id="配置国内镜像"><a href="#配置国内镜像" class="headerlink" title="配置国内镜像"></a>配置国内镜像</h2><p>国内镜像战有中科大的源和清华的源，中科大是http，清华是https，所以我选用了清华的。</p>
<p>我的配置原则是删除默认全部，只保留国内镜像一条。</p>
<p>编辑 <code>/etc/pacman.d/mirrorlist.mingw32</code> ，在文件开头添加：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">Server = https://mirrors.tuna.tsinghua.edu.cn/msys2/mingw/i686<br></code></pre></td></tr></table></figure>

<p>编辑 <code>/etc/pacman.d/mirrorlist.mingw64</code> ，在文件开头添加：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">Server = https://mirrors.tuna.tsinghua.edu.cn/msys2/mingw/x86_64<br></code></pre></td></tr></table></figure>

<p>编辑 <code>/etc/pacman.d/mirrorlist.msys</code> ，在文件开头添加：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">Server = https://mirrors.tuna.tsinghua.edu.cn/msys2/msys/$arch<br></code></pre></td></tr></table></figure>

<p>然后执行 <code>pacman -Sy</code> 刷新软件包数据即可。</p>
<h2 id="msys2系统更新"><a href="#msys2系统更新" class="headerlink" title="msys2系统更新"></a>msys2系统更新</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">pacman -Syu<br></code></pre></td></tr></table></figure>

<ul>
<li>  更新时会遇到警告，根据警告信息提示，我们可以关闭窗口</li>
<li>  点击关闭窗口按钮后会弹出一个警告框提示，提示信息是窗口会话有进程正在运行，这里不用管，点OK就行。</li>
</ul>
<p>到这里更新并没有结束，重复配置源部分，再打开msys2进行更新即可。</p>
<h2 id="密钥失效问题"><a href="#密钥失效问题" class="headerlink" title="密钥失效问题"></a>密钥失效问题</h2><p>使用<code>pacman -Syu</code>时显示无法远程查找到密钥。</p>
<h3 id="错误原因"><a href="#错误原因" class="headerlink" title="错误原因"></a>错误原因</h3><p>密钥无法信赖(rely  on)msys2-keyring密钥服务器，如果不及时更新msys2-keyring，就会出现上面的错误提示。</p>
<h3 id="修复办法："><a href="#修复办法：" class="headerlink" title="修复办法："></a>修复办法：</h3><p>msys2官方提供了一个msys2-keyring-r21.b39fb11-1-any.pkg.tar.xz的软件包来修复。</p>
<p>修复前验证下（无法通过）：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext"># pacman-key --verify msys2-keyring-r21.b39fb11-1-any.pkg.tar.xz&#123;.sig,&#125;<br></code></pre></td></tr></table></figure>

<p>开始修复：</p>
<ol>
<li><p><strong>下载 msys2-keyring-r21.b39fb11-1-any.pkg.tar.xz 软件包</strong></p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext"># curl -O http://repo.msys2.org/msys/x86_64/msys2-keyring-r21.b39fb11-1-any.pkg.tar.xz<br># curl -O http://repo.msys2.org/msys/x86_64/msys2-keyring-r21.b39fb11-1-any.pkg.tar.xz.sig<br></code></pre></td></tr></table></figure></li>
<li><p><strong>验证签名是否建立完好</strong></p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext"># pacman-key --verify msys2-keyring-r21.b39fb11-1-any.pkg.tar.xz&#123;.sig,&#125;<br></code></pre></td></tr></table></figure></li>
<li><p><strong>安装 msys2-keyring-r21.b39fb11-1-any.pkg.tar.xz 包</strong></p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext"># pacman -U --config &lt;(echo) msys2-keyring-r21.b39fb11-1-any.pkg.tar.xz<br></code></pre></td></tr></table></figure></li>
<li><p> <strong>然后就可以使用<code>pacman -Syu</code>进行更新</strong></p>
</li>
</ol>
<blockquote>
<p>  【注1】</p>
<p>  如果还存在签名问题导致无法更新，可以尝试重置<code>pacman key</code>：</p>
<p>  <code># rm -r /etc/pacman.d/gnupg/</code></p>
<p>  <code># pacman-key --init</code></p>
<p>  <code># pacman-key --populate msys2</code></p>
<p>  然后再<code>pacman -Syu</code>进行更新</p>
<p>  【注2】</p>
<p>  修复完毕后，可能需要重启计算机。</p>
</blockquote>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/xfijun/article/details/107810097">解决msys2“无法升级 mingw64 (无效或已损坏的数据库 (PGP 签名))”密钥失效问题</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/CodeWorkerLiMing/p/12274583.html">MSYS2使用教程（整理）——win10系统64位安装msys2最新版（msys2-x86_64-20190524.exe）</a></p>

	</div>
</div>
<div id="totop" style="position:fixed;bottom:150px;right:50px;cursor: pointer;font-size:26px;background-color:#8590a6">
	<a title="返回顶部" style="color:#04fa9f"><⇧></a>
</div>
<script src="/js/totop.js"></script>
<script>
    function setClipboardText(event){
        
        let clipboardData = event.clipboardData || window.clipboardData;
        
        if (!clipboardData) { return; }
        event.preventDefault();
        
        let text = window.getSelection().toString();
		    
        if (text) {
            
            event.preventDefault();
            
            var copyright = '\n\n'
            + '\n作品采用 知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议 进行许可'
            + '\n著作权归作者所有，商业转载请联系作者获得授权，非商业转载请注明出处。'
            + '\n作者: modao'
            + '\n邮箱: rustacean@aliyun.com'
            + '\n原文地址: https://modao.site/Software/Windows/msys2/'
			
            clipboardData.setData('text/plain', text + copyright);
    
        }
    };
	
    var contents = document.getElementsByClassName("content-area");
   
    contents[0].addEventListener('copy',function(e){
        setClipboardText(e);
    });

</script>
    
  </body>
</html>