<!doctype html><html lang=zh-Hans-CN><head><title>modao's blog</title><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1.0,maximum-scale=1" name=viewport><meta content=noodp name=robots><link href=https://modao.site/style.css rel=stylesheet><link href=https://modao.site/color/green.css rel=stylesheet><link href=https://modao.site/color/background_dark.css rel=stylesheet><link href=https://modao.site/font-hack.css rel=stylesheet><script src="https://www.googletagmanager.com/gtag/js?id=G-N2WTGJE0M5" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-N2WTGJE0M5');</script><body><div class=container><header class=header><div class=header__inner><div class=header__logo><a style="text-decoration: none;" href=https://modao.site> <div class=logo>MODAO</div> </a></div></div><nav class=menu><ul class=menu__inner><li class=active><a href=https://modao.site>Home</a><li><a href=https://modao.site/tags>Tags</a><li><a href=https://modao.site/language>Programming-Language</a><li><a href=https://modao.site/books>Books</a><li><a href=https://modao.site/links>Links</a><li><a href=https://modao.site/friend>Friend</a></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=https://modao.site/编程语言/Python/PyQt5/drag-and-drop-in-pyqt5/>PyQt5 中的拖放</a></h1><div class=post-meta-inline><span class=post-date> 2020-08-20 </span></div><div class=post-content><p><a href=http://zetcode.com/gui/pyqt5/dragdrop/>翻译自原文：Drag and drop in PyQt5</a><p>翻译时间 2020 年 8 月 20 日<p>在 PyQt5 教程的这一部分中，我们将讨论拖放操作。<p>在计算机图形用户界面中，拖放是单击虚拟对象并将其拖动到其他位置或其他虚拟对象的操作（或支持的操作）。通常，它可用于调用多种类型的操作，或在两个抽象对象之间创建各种类型的关联。<p>拖放是图形用户界面的一部分。拖放操作使用户能够直观地执行复杂操作。<p>通常，我们可以拖放两件事情：数据或一些图形对象。如果我们将图像从一个应用程序拖到另一个应用程序，我们会拖放二进制数据。如果我们在 Firefox 中拖动一个选项卡并将其移动到另一个位置，我们会拖放图形组件。<h2 id=qdrag>QDrag</h2><p><code>QDrag</code>为基于 MIME 的拖放数据传输提供支持。它处理拖放操作的绝大多数详细信息。传输的数据存放在<code>QMimeData</code>对象中。<h2 id=pyqt5-zhong-de-jian-dan-tuo-fang-shi-li>PyQt5 中的简单拖放示例</h2><p>在第一个示例中，我们使用<code>QLineEdit</code>和<code>QPushButton</code>。我们从行编辑部件拖动纯文本，并将其拖放到按钮小部件上，按钮的标签将更改。<p>simple_dragdrop.py<pre style=background-color:#2b303b;color:#c0c5ce;><code><span>import sys</span><span>
</span><span>
</span><span>from PyQt5.QtWidgets import (QPushButton, QWidget,</span><span>
</span><span>                             QLineEdit, QApplication)</span><span>
</span><span>
</span><span>
</span><span>class Button(QPushButton):</span><span>
</span><span>
</span><span>    def __init__(self, title, parent):</span><span>
</span><span>        super().__init__(title, parent)</span><span>
</span><span>
</span><span>        self.setAcceptDrops(True)</span><span>
</span><span>
</span><span>    def dragEnterEvent(self, e):</span><span>
</span><span>
</span><span>        if e.mimeData().hasFormat('text/plain'):</span><span>
</span><span>            e.accept()</span><span>
</span><span>        else:</span><span>
</span><span>            e.ignore()</span><span>
</span><span>
</span><span>    def dropEvent(self, e):</span><span>
</span><span>
</span><span>        self.setText(e.mimeData().text())</span><span>
</span><span>
</span><span>
</span><span>class Example(QWidget):</span><span>
</span><span>
</span><span>    def __init__(self):</span><span>
</span><span>        super().__init__()</span><span>
</span><span>
</span><span>        self.initUI()</span><span>
</span><span>
</span><span>    def initUI(self):</span><span>
</span><span>
</span><span>        edit = QLineEdit('', self)</span><span>
</span><span>        edit.setDragEnabled(True)</span><span>
</span><span>        edit.move(30, 30)</span><span>
</span><span>
</span><span>        button = Button("Button", self)</span><span>
</span><span>        button.move(30, 60)</span><span>
</span><span>
</span><span>        self.setWindowTitle('Simple drag and drop')</span><span>
</span><span>        self.setGeometry(300, 300, 300, 150)</span><span>
</span><span>
</span><span>
</span><span>def main():</span><span>
</span><span>
</span><span>    app = QApplication(sys.argv)</span><span>
</span><span>    ex = Example()</span><span>
</span><span>    ex.show()</span><span>
</span><span>    app.exec_()</span><span>
</span><span>
</span><span>
</span><span>if __name__ == '__main__':</span><span>
</span><span>    main()</span><span>
</span></code></pre><p>该示例提供了一个简单的拖放操作。<pre style=background-color:#2b303b;color:#c0c5ce;><code><span>class Button(QPushButton):</span><span>
</span><span>
</span><span>    def __init__(self, title, parent):</span><span>
</span><span>        super().__init__(title, parent)</span><span>
</span><span>
</span><span>        ...</span><span>
</span></code></pre><p>为了在<code>QPushButton</code>部件上放置文本，我们必须重新实现一些方法。因此，我们创建自己的类<code>Button</code>，继承自<code>QPushButton</code>。<pre style=background-color:#2b303b;color:#c0c5ce;><code><span>self.setAcceptDrops(True)</span><span>
</span></code></pre><p>我们使用<code>setAcceptDrops()</code>启用部件的放置事件。<pre style=background-color:#2b303b;color:#c0c5ce;><code><span>def dragEnterEvent(self, e):</span><span>
</span><span>
</span><span>    if e.mimeData().hasFormat('text/plain'):</span><span>
</span><span>        e.accept()</span><span>
</span><span>    else:</span><span>
</span><span>        e.ignore()</span><span>
</span></code></pre><p>首先，我们重新实现<code>dragEnterEvent()</code>方法。我们会告知我们接受的被拖进来的数据类型。在我们的案例中，它是纯文本。<pre style=background-color:#2b303b;color:#c0c5ce;><code><span>def dropEvent(self, e):</span><span>
</span><span>
</span><span>    self.setText(e.mimeData().text())</span><span>
</span></code></pre><p>通过重新实现<code>dropEvent()</code>方法，我们定义了在<code>drop</code>事件中的操作。在这里，我们改变按钮部件的文本。<pre style=background-color:#2b303b;color:#c0c5ce;><code><span>edit = QLineEdit('', self)</span><span>
</span><span>edit.setDragEnabled(True)</span><span>
</span></code></pre><p><code>QLineEdit</code>部件具有对拖动操作的内置支持。我们只需调用<code>setDragEnabled()</code>该方法来激活它。<p><img alt=image-20200820171620457 src=Drag-and-drop-in-PyQt5/image-20200820171620457.png></p><center>图：简单的拖放</center><h2 id=tuo-fang-an-niu-xiao-bu-jian>拖放按钮小部件</h2><p>下面的示例演示如何拖放按钮部件。<p>drag_button.py<pre style=background-color:#2b303b;color:#c0c5ce;><code><span>import sys</span><span>
</span><span>
</span><span>from PyQt5.QtCore import Qt, QMimeData</span><span>
</span><span>from PyQt5.QtGui import QDrag</span><span>
</span><span>from PyQt5.QtWidgets import QPushButton, QWidget, QApplication</span><span>
</span><span>
</span><span>
</span><span>class Button(QPushButton):</span><span>
</span><span>
</span><span>    def __init__(self, title, parent):</span><span>
</span><span>        super().__init__(title, parent)</span><span>
</span><span>
</span><span>    def mouseMoveEvent(self, e):</span><span>
</span><span>
</span><span>        if e.buttons() != Qt.RightButton:</span><span>
</span><span>            return</span><span>
</span><span>
</span><span>        mimeData = QMimeData()</span><span>
</span><span>
</span><span>        drag = QDrag(self)</span><span>
</span><span>        drag.setMimeData(mimeData)</span><span>
</span><span>        drag.setHotSpot(e.pos() - self.rect().topLeft())</span><span>
</span><span>
</span><span>        dropAction = drag.exec_(Qt.MoveAction)</span><span>
</span><span>
</span><span>    def mousePressEvent(self, e):</span><span>
</span><span>
</span><span>        super().mousePressEvent(e)</span><span>
</span><span>
</span><span>        if e.button() == Qt.LeftButton:</span><span>
</span><span>            print('press')</span><span>
</span><span>
</span><span>
</span><span>class Example(QWidget):</span><span>
</span><span>
</span><span>    def __init__(self):</span><span>
</span><span>        super().__init__()</span><span>
</span><span>
</span><span>        self.initUI()</span><span>
</span><span>
</span><span>    def initUI(self):</span><span>
</span><span>
</span><span>        self.setAcceptDrops(True)</span><span>
</span><span>
</span><span>        self.button = Button('Button', self)</span><span>
</span><span>        self.button.move(100, 65)</span><span>
</span><span>
</span><span>        self.setWindowTitle('Click or Move')</span><span>
</span><span>        self.setGeometry(300, 300, 550, 450)</span><span>
</span><span>
</span><span>    def dragEnterEvent(self, e):</span><span>
</span><span>        e.accept()</span><span>
</span><span>
</span><span>    def dropEvent(self, e):</span><span>
</span><span>        position = e.pos()</span><span>
</span><span>        self.button.move(position)</span><span>
</span><span>
</span><span>        e.setDropAction(Qt.MoveAction)</span><span>
</span><span>        e.accept()</span><span>
</span><span>
</span><span>
</span><span>def main():</span><span>
</span><span>    </span><span>
</span><span>    app = QApplication(sys.argv)</span><span>
</span><span>    ex = Example()</span><span>
</span><span>    ex.show()</span><span>
</span><span>    app.exec_()</span><span>
</span><span>
</span><span>
</span><span>if __name__ == '__main__':</span><span>
</span><span>    main()</span><span>
</span></code></pre><p>在我们的代码示例中，我们有一个窗口。如果我们单击鼠标左键的按钮，则"press"消息将打印到控制台。通过右键单击并移动按钮，我们对按钮<code>QPushButton</code>部件执行拖放操作。<pre style=background-color:#2b303b;color:#c0c5ce;><code><span>class Button(QPushButton):</span><span>
</span><span>
</span><span>    def __init__(self, title, parent):</span><span>
</span><span>        super().__init__(title, parent)</span><span>
</span></code></pre><p>我们创建一个派生自<code>QPushButton</code>的类<code>Button</code>。我们还重新实现<code>QPushButton</code>的两种方法：<code>mouseMoveEvent()</code>和<code>mousePressEvent()</code>。<code>mouseMoveEvent()</code>方法是拖放操作开始的位置。<pre style=background-color:#2b303b;color:#c0c5ce;><code><span>if e.buttons() != Qt.RightButton:</span><span>
</span><span>    return</span><span>
</span></code></pre><p>在这里，我们决定，我们只能用鼠标右键执行拖放。左鼠标按钮保留用于单击该按钮。<pre style=background-color:#2b303b;color:#c0c5ce;><code><span>mimeData = QMimeData()</span><span>
</span><span>
</span><span>drag = QDrag(self)</span><span>
</span><span>drag.setMimeData(mimeData)</span><span>
</span><span>drag.setHotSpot(e.pos() - self.rect().topLeft())</span><span>
</span></code></pre><p><code>QDrag</code>对象已创建。该类对基于 MIME 的拖放数据传输提供支持。<pre style=background-color:#2b303b;color:#c0c5ce;><code><span>dropAction = drag.exec_(Qt.MoveAction)</span><span>
</span></code></pre><p>拖动对象的<code>exec_()</code>方法启动拖放操作。<pre style=background-color:#2b303b;color:#c0c5ce;><code><span>def mousePressEvent(self, e):</span><span>
</span><span>
</span><span>    super().mousePressEvent(e)</span><span>
</span><span>
</span><span>    if e.button() == Qt.LeftButton:</span><span>
</span><span>        print('press')</span><span>
</span></code></pre><p>如果我们左键单击鼠标按钮，我们会将"press"到控制台。请注意，我们也在父级上调用<code>mousePressEvent()</code>方法。否则，我们不会看到按下按钮。<pre style=background-color:#2b303b;color:#c0c5ce;><code><span>position = e.pos()</span><span>
</span><span>self.button.move(position)</span><span>
</span></code></pre><p>在<code>dropEvent()</code>方法中，我们指定释放鼠标按钮并完成放置操作后发生的情况。在我们的案例中，我们找出当前鼠标指针的位置，并相应地移动按钮。<pre style=background-color:#2b303b;color:#c0c5ce;><code><span>e.setDropAction(Qt.MoveAction)</span><span>
</span><span>e.accept()</span><span>
</span></code></pre><p>我们使用<code>setDropAction()</code>指定<code>drop</code>动作的类型。在我们的案例中，这是一个移动动作。<p>PyQt5 教程的这一部分专门用于拖放操作。</div></div></div><footer class=footer__poweredby><p class=caption>© 2022 All Rights Reserved modao::rustacean@aliyun.com<p class=caption>© Powered by <a href=https://www.getzola.org/>Zola</a><p class=caption>© Theme: <a href=https://github.com/pawroman/zola-theme-terminimal/>Terminimal</a> by pawroman<p class=caption><a href=https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh rel=license>自由转载-非商用-非衍生-保持署名</a></footer></div>