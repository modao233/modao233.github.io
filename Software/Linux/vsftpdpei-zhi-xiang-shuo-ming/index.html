<!doctype html><html lang=zh-Hans-CN><head><title>modao's blog</title><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1.0,maximum-scale=1" name=viewport><meta content=noodp name=robots><link href=https://modao.site/style.css rel=stylesheet><link href=https://modao.site/color/green.css rel=stylesheet><link href=https://modao.site/color/background_dark.css rel=stylesheet><link href=https://modao.site/font-hack.css rel=stylesheet><body><div class=container><header class=header><div class=header__inner><div class=header__logo><a style="text-decoration: none;" href=https://modao.site> <div class=logo>MODAO</div> </a></div></div><nav class=menu><ul class=menu__inner><li class=active><a href=https://modao.site>Home</a><li><a href=https://modao.site/tags>Tags</a><li><a href=https://modao.site/language>Programming-Language</a><li><a href=https://modao.site/books>Books</a><li><a href=https://modao.site/links>Links</a><li><a href=https://modao.site/friend>Friend</a><li><a href=https://modao.site/about>About Me</a></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=https://modao.site/Software/Linux/vsftpdpei-zhi-xiang-shuo-ming/>vsftpd配置项说明</a></h1><div class=post-meta-inline><span class=post-date> 2022-01-29 </span></div><span class=post-tags-inline> :: tags:  <a class=post-tag href=https://modao.site/tags/software/>#Software</a>  <a class=post-tag href=https://modao.site/tags/linux/>#Linux</a></span><div class=post-content><p>https://www.cnblogs.com/halberd-lee/p/11734363.html<h1 id=vsftpd-chang-yong-gong-neng-can-shu-pei-zhi-ji-can-shu-xiang-jie>vsftpd 常用功能参数配置及参数详解</h1><h2 id=1-pei-zhi-chao-ji-fu-wu>1 <strong>配置超级服务</strong></h2><pre class=language-plain data-lang=plain style=background-color:#2b303b;color:#c0c5ce;><code class=language-plain data-lang=plain><span>vi /etc/xinetd.d/vsftpd
</span><span>service ftp
</span><span>{
</span><span>    disable           = no
</span><span>    socket_type       = stream
</span><span>    wait              = no
</span><span>    user              = root server            = /usr/sbin/vsftpd
</span><span>    server_args       = /etc/vsftpd/vsftpd.conf
</span><span># 上面这个 server 的设定请依照您的主机环境来设定！
</span><span># 至于 server_args 则请写入您的 vsftpd 的配置文件完整名称即可！
</span><span>    per_source        = 5     <==与同一 IP 的联机数目有关
</span><span>    instances         = 200   <==同一时间最多的联机数目
</span><span>    no_access         = 192.168.1.3
</span><span>    banner_fail       = /etc/vsftpd/vsftpd.busy_banner
</span><span># 上面这个文件就是当主机忙碌中，则在 Client 端显示的内容！
</span><span>    log_on_success    += PID HOST DURATION
</span><span>    log_on_failure    += HOST
</span><span>}
</span><span>
</span><span>[root@localhost ~]# vi /etc/vsftpd/vsftpd.conf
</span><span>listen=NO
</span></code></pre><h2 id=2-pei-zhi-ni-ming-yong-hu>2 <strong>配置匿名用户</strong></h2><pre class=language-plain data-lang=plain style=background-color:#2b303b;color:#c0c5ce;><code class=language-plain data-lang=plain><span>[root@localhost ~]# vi /etc/vsftpd/vsftpd.conf
</span><span>anonymous_enable=YES
</span></code></pre><p>Table 1: 匿名用户配置<table><thead><tr><th>参数<th>说明<tbody><tr><td>anonymous_enable=YES<td>是否允许匿名登录 yes=允许 no= 不允许<tr><td>ftp_username=ftp<td>设置ftp匿名登录时的用户名，默认 ftp<tr><td>no_anon_password=YES<td>匿名用户登录不需要输入密码 默认 YES<tr><td>deny_email_enable=YES<td>以banned_email_file里面的电子邮件为密码的匿名用户不能登录<tr><td>anon_root<td>匿名用户登录后的默认目录，不设置，默认为/var/ftp<tr><td>anon_upload_enable=YES<td>允许匿名登录用户上传文件 默认NO<tr><td>anon_mkdir_write_enable=YES<td>允许匿名登录用户创建目录 默认NO<tr><td>anon_other_write_enable=NO<td>允许匿名用户有较高的写权限包括 删除目录和重命名等 默认NO<tr><td>anon_world_readable_only=YES<td>允许匿名用户下载可读文件 默认YES , 设置为yes时只能下载不能直接在Ftp中阅读。<tr><td>chown_uploads=YES<td>设置是否改变匿名用户上传文件（非目录）的属主。默认值为NO。</table><h2 id=3-pei-zhi-ben-di-yong-hu-deng-lu>3 <strong>配置本地用户登录</strong></h2><pre class=language-plain data-lang=plain style=background-color:#2b303b;color:#c0c5ce;><code class=language-plain data-lang=plain><span>[root@localhost ~]# vi /etc/vsftpd/vsftpd.conf
</span><span>#下面是允许某些用户登入的项目  存在user_list文件中的用户不允许登入
</span><span>userlist_enable=YES
</span><span>userlist_deny=YES #如果这里改为NO  反过来只能存在user_list文件中的用户允许登入
</span><span>userlist_file=/etc/vsftpd/user_list
</span><span>anonymous_enable=NO
</span><span>
</span><span>#下面是限制用户只能访问自己的主目录  存在chroot_list文件中的用户只能访问自己的主目录
</span><span>chroot_local_user=YES
</span><span>chroot_list_enable=YES
</span><span>chroot_list_file=/etc/vsftpd/chroot_list
</span></code></pre><h2 id=4-pei-zhi-xu-ni-yong-hu-deng-lu>4 <strong>配置虚拟用户登录</strong></h2><pre class=language-plain data-lang=plain style=background-color:#2b303b;color:#c0c5ce;><code class=language-plain data-lang=plain><span>#创建虚拟用户的专用目录
</span><span>[root@localhost ~]# mkdir /home/vsftpd/admin
</span><span>
</span><span>
</span><span>[root@localhost ~]# vi /etc/vsftpd/loginuser.txt
</span><span>#加入两个用户  奇数行代表用户名 偶数行代表密码
</span><span>admin
</span><span>admin123
</span><span>
</span><span>#执行命令 生成虚拟数据库
</span><span>[root@localhost ~]# db_load -T -t hash -f /etc/vsftpd/loginuser.txt /etc/vsftpd/login.db
</span><span>#设置数据库文件的访问权限
</span><span>[root@localhost ~]# chmod 600 /etc/vsftpd/login.db
</span><span>[root@localhost ~]# vi /etc/pam.d/vsftpd
</span><span>#将以下内容增加的原文件前面两行：
</span><span>auth    required        pam_userdb.so db=/etc/vsftpd/login
</span><span>account required        pam_userdb.so db=/etc/vsftpd/login
</span><span>auth    sufficient      pam_userdb.so db=/etc/vsftpd/login
</span><span>account sufficient      pam_userdb.so db=/etc/vsftpd/login
</span><span>#我们建立的虚拟用户将采用PAM进行验证，这是通过/etc/vsftpd.conf文件中的 语句pam_service_name=vsftpd 来启用的。
</span><span>
</span><span>#auth       required     pam_listfile.so item=user sense=deny file=/etc/vsftpd.ftpusers onerr=succeed
</span><span>#auth       required     pam_stack.so service=system-auth
</span><span>#auth       required     pam_shells.so
</span><span>#account    required     pam_stack.so service=system-auth
</span><span>#session    required     pam_stack.so service=system-auth
</span><span>
</span><span>可以看出前面两行是对虚拟用户的验证，后面是对系统用户的验证。 为了安全我一般把系统用户的登入关闭  使用虚拟账号登入ftp
</span><span>对虚拟用户的验证使用了sufficient这个控制标志。
</span><span>这个标志的含义是如果这个模块验证通过，就不必使用后面的层叠模块进行验证了；但如果失败了，
</span><span>就继续后面的认证，也就是使用系统真实用户的验证。
</span><span>虚拟用户创建本地系统用户
</span><span>
</span><span>#新建一个系统用户vsftpd, 用户登录终端设为/bin/false(即使之不能登录系统)
</span><span>[root@localhost ~]# useradd vsftpd -d /home/vsftpd -s /bin/false
</span><span>[root@localhost ~]# chown vsftpd:vsftpd /home/vsftpd #改变目录所属用户组
</span><span>
</span><span>根据需要创建/etc/vsftpd/vsftpd.conf，以下设置：
</span><span>listen=YES                             #监听为专用模式
</span><span>anonymous_enable=NO                    #禁用匿名登入
</span><span>dirmessage_enable=YES
</span><span>xferlog_enable=YES
</span><span>xferlog_file=/var/log/vsftpd.log       #记录ftp操作日志
</span><span>xferlog_std_format=YES
</span><span>chroot_local_user=YES                  #对用户访问只限制在主目录 不能访问其他目录
</span><span>guest_enable=YES                       #启用guest
</span><span>guest_username=vsftpd                  #使用虚拟账号形式
</span><span>user_config_dir=/etc/vsftpd/user_conf  #虚拟账号配置目录
</span><span>pam_service_name=vsftpd                #对vsftpd的用户使用pam认证
</span><span>local_enable=YES
</span><span>
</span><span>#执行以下命令
</span><span>[root@localhost ~]# mkdir /etc/vsftpd/user_conf
</span><span>[root@localhost ~]# cd /etc/vsftpd/user_conf
</span><span>[root@localhost ~]# vi /etc/vsftpd/user_conf/admin
</span><span>#加入以下内容 拥有所有权限
</span><span>write_enable=YES
</span><span>anon_world_readable_only=NO
</span><span>anon_upload_enable=YES
</span><span>anon_mkdir_write_enable=YES
</span><span>anon_other_write_enable=YES
</span><span>local_root=/home/vsftpd/admin
</span><span>
</span><span>#如果不能读写操作 可能是目录权限不够需要设置权限 试试看
</span><span>[root@localhost ~]# chmod 777 /home/vsftpd/admin
</span></code></pre><h2 id=5-shi-yong-ssldeng-ru>5 <strong>使用SSL登入</strong></h2><pre class=language-plain data-lang=plain style=background-color:#2b303b;color:#c0c5ce;><code class=language-plain data-lang=plain><span>[root@localhost ~]# cd /etc/pki/tls/certs/
</span><span>[root@localhost ~]# openssl req -new -x509 -nodes -out vsftpd.pem -keyout vsftpd.pem
</span><span>[root@localhost ~]#vi /usr/local/etc/vsftpd.conf
</span><span>ssl_enable=YES(开启vsftpd对ssl协议的支持)
</span><span>ssl_sslv2=YES（支持SSL v2 protocol）
</span><span>ssl_sslv3=YES（支持SSL v3 protocol）
</span><span>ssl_tlsv1=YES（支持TSL v1）
</span><span>rsa_cert_file=/etc/pki/tls/certs/vsftpd.pem（证书的路径）
</span><span>
</span><span>ssl_enable=YES
</span><span>ssl_sslv2=YES
</span><span>ssl_sslv3=YES
</span><span>ssl_tlsv1=YES
</span></code></pre><p>这样重启vsftpd 就可以用客户端来尝试进行SSL加密连接了 。<p>相关参数说明:<p>Table 2: ssl 加密协议配置<table><thead><tr><th>参数<th>说明<tbody><tr><td>allow_anon_ssl=NO<td>是否允许SSL连接，启用SSL后才可以使用此参数，默认NO<tr><td>ssl_enable=NO<td>是否启用ssl 安全连接 默认NO 如果设置为yes,vsftpd。<tr><td> <td>将启用openSSL，通过SSL支持安全连接和数据传输<tr><td>force_local_logins_ssl=YES<td>是否对非匿名用户登录加密 默认yes<tr><td>force_local_data_ssl=YES<td>是否对非匿名用户传输加密 默认yes<tr><td>force_anon_logins_ssl=NO<td>匿名用户登录时是否加密 默认为no<tr><td>force_anon_data_ssl=NO<td>匿名用户数据传输时是否加密 默认为no<tr><td>ssl_sslv2=NO<td>是否开户sslv2协议。 默认NO ，如果设置为yes,<tr><td> <td>前提为ssl_enable=YES<tr><td>ssl_sslv3=NO<td>是否开户sslv3协议。 默认NO ，如果设置为yes,<tr><td> <td>前提为ssl_enable=YES<tr><td>dsa_cert_file<td>为ssl加密连接指定dsa证书位置 默认 无<tr><td>ssl_ciphers<td>是否指定加密方式 默认 DES-CBC3-SHA</table><h2 id=6-ri-zhi-wen-jian>6 <strong>日志文件</strong></h2><table><thead><tr><th>参数<th>说明<tbody><tr><td>dual_log_enable=NO<td># 是否启用双日志,默认NO 如果设置为yes，则分别在/var/log/xferlog、<tr><td> <td>var/log/vsftpd.log里记录日志。前一个为wu-ftpd格式，可被通用工具<tr><td> <td>分析，后一个为vsftpd的专用格式<tr><td>xferlog_enable=YES<td># 激活上传和下传的日志 依赖 参数xferlog_std_format的设置<tr><td>xferlog_std_format=YES<td># 使用标准格式记录上传、下传日志<tr><td>syslog_enable=NO<td># 是否关闭vsftpd的日志并记录系统日志 默认NO ，如果设置为YES,系<tr><td> <td>统日志会记录到/var/log/vsftpd.log,而VSFTPD的日志进程将停止。</table><h2 id=7-chuan-shu-mo-shi>7 <strong>传输模式</strong></h2><table><thead><tr><th>参数<th>说明<tbody><tr><td>ascii_download_enable=YES<td>是否启用ascii模式下载文件 默认 NO<tr><td>ascii_upload_enable=YES<td>是否启用ascii模式上传文件 默认 NO<tr><td>async_abor_enable=NO<td>是否启用强制中止传输文件 默认 NO 启用此参数是为了<tr><td> <td>免中止传输时的客户端挂死。只有特殊情况下才使用。<tr><td>background=NO<td>是否后台启动vsftpd监听 默认 NO 启用后，VSFTPD将<tr><td> <td>监听进程置于后台，当访问vsftpd服务时，console 会返<tr><td> <td>回到shell 模式<tr><td>check_shell=YES<td>检测是否有可用的shell环境 默认 YES<tr><td>userlist_enable=YES<td>启用user_list 文件的检查 默认 NO 为YES时检查<tr><td> <td>user_list文件中的用户列表,为NO 时不检测该文件<tr><td>userlist_deny=NO<td>只有在userlist_enable 启用时有效，默认YES .<tr><td> <td>YES: 表示user_list文件中的用户不允许登录ftp<tr><td> <td>NO: 表示只允许user_list文件中的用户登录FTP</table><h2 id=8-chuan-shu-su-lu-she-zhi>8 <strong>传输速率设置</strong></h2><table><thead><tr><th>参数<th>说明<th>默认值<tbody><tr><td>anon_max_rate<td>匿名用户允许的最大传输速率<td>0秒<tr><td>local_max_rate<td>本地认证用户的最大传输速率<td>0秒</table><h2 id=9-chao-shi-she-zhi>9 <strong>超时设置</strong></h2><table><thead><tr><th>参数<th>说明<th>默认值<tbody><tr><td>accept_timeout<td>尝试连接时间<td>60s<tr><td>data_connection_timeout<td>数据传输延迟的最大时间，超过限制，会话将被终止<td>300s<tr><td>idle_session_timeout<td>连接建立后，两次ftp命令之间的时间间隔，超时会话将被终止<td>300s</table><h2 id=10-yong-hu-chuang-jian-de-wen-jian-de-quan-xian>10 <strong>用户创建的文件的权限</strong></h2><table><thead><tr><th>参数<th>说明<th>默认值<tbody><tr><td>anon_umask<td>匿名用户创建的文件的默认权限<td>022<tr><td>local_umas<td>本地用户创建的文件的默认权限<td>022</table><h2 id=11-lian-jie-shu-she-zhi>11 <strong>连接数设置</strong></h2><table border=2 cellpadding=6 cellspacing=0 frame=hsides rules=groups><colgroup><col class=org-left><col class=org-left><col class=org-right></colgroup><tbody><tr><td class=org-left>参数<td class=org-left>说明<td class=org-right>默认值<tr><td class=org-left>max_clients<td class=org-left>允许的最大连接数<td class=org-right>0<tr><td class=org-left>max_per_ip<td class=org-left>单个IP允许的最大连接数<td class=org-right>0</table><h2 id=12-duan-kou-she-zhi>12 <strong>端口设置</strong></h2><table><thead><tr><th>参数<th>说明<th>默认值<tbody><tr><td>listen_port=21<td>FTP服务器建立连接所侦听的端口<td>21<tr><td>ftp_data_port<td>数据传输所使用的默认端口<td>20<tr><td>connect_from_port_20=YES<td>指定FTP数据传输连接使用20端口,设置为NO时，则进<td>NO<tr><td> <td>行数据连接时，所使用的端口由ftp_data_port指定<td> <tr><td>pasv_max_port=0<td>passive 模式下数据传输使用的端口上限<td>0<tr><td>pasv_mim_port=0<td>passive 模式下数据传输使用的端口下限<td>0</table><h2 id=13-yong-hu-fang-wen-quan-xian>13 <strong>用户访问权限</strong></h2><table><thead><tr><th>参数<th>说明<tbody><tr><td>chroot_list_enable=YES<td>是否改变用户的根目录, 默认 NO。 当设置为YES时，需要以root<tr><td> <td>用户做如下操作:<tr><td> <td>mkdir /etc/vsftpd/userconf;<tr><td> <td>cat >>$username<&LTeof<tr><td> <td>local_root=$path<tr><td> <td>EOF<tr><td> <td>说明 "$username" 是需要改变默认根目录的用户比如用户aaa<tr><td> <td>，$path 为你想要用户aaa默认访问的路径 ，比如/data/aaa<tr><td>chroot_list_enable=YES<td>设置是否启用chroot_list_file配置项指定的用户列表文件。<tr><td> <td>默认值为NO<tr><td>chroot_list_file=/etc/vsftpd/chroot_list<td>用于指定存储用户列表文件，该文件用于控制哪些用户只可以<tr><td> <td>访问自己的根目录，不可以访问根路径的上级路径目录<tr><td>chroot_local_user=YES<td>用于指定用户列表文件中的用户是否允许切换到上级目录。默认值为NO。<tr><td> <td>通过搭配能实现以下多种效果。见表格下方。</table><p>①当chroot_list_enable=YES，chroot_local_user=YES时，在/etc/vsftpd/chroot_list文件中列出的用户，可以切换到根路径的上级路径；未在文件中列出的用户，则不能切换。<p>②当chroot_list_enable=YES，chroot_local_user=NO时，在/etc/vsftpd/chroot_list文件中列出的用户，不能切换到根路径的上级路径；未在文件中列出的用户，则可以切换。<p>③当chroot_list_enable=NO，chroot_local_user=YES时，所有的用户均不能切换到用户根路径的上级路径<p>④当chroot_list_enable=NO，chroot_local_user=NO时，所有的用户均可以切换到用户根路径的上级路径</div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2022 modao</span><span class=copyright-theme> <span class=copyright-theme-sep>:: </span> Theme: <a href=https://github.com/pawroman/zola-theme-terminimal/>Terminimal</a> by pawroman </span></div></div></footer></div>