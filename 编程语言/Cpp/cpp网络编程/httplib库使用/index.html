<!DOCTYPE html>
<html>
<!-- html页面布局的head -->

<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	<title>
		modao
	</title>

	<!-- 百度统计代码 -->
	<script>
		var _hmt = _hmt || [];
		(function () {
			var hm = document.createElement("script");
			hm.src = "https://hm.baidu.com/hm.js?902dc461fe0d25f09e74e0d04677b6d8";
			var s = document.getElementsByTagName("script")[0];
			s.parentNode.insertBefore(hm, s);
		})();
	</script>

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-N2WTGJE0M5"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag() { dataLayer.push(arguments); }
		gtag('js', new Date());

		gtag('config', 'G-N2WTGJE0M5');
	</script>
<meta name="generator" content="Hexo 5.4.0"></head>

  <body>

    <!-- 文章详情页模板 -->

<!-- 主页标题栏 -->

<link rel="stylesheet" href="/css/navigatebar.css">


<header class="header">
	<div class="topbar">
		<div class="topbar-button topbar-mine">
			<a href="/">
				modao
			</a>
		</div>
		
			<div class="topbar-button">
				<a href="/">
					Home
				</a>
			</div>
		
			<div class="topbar-button">
				<a href="/categories">
					Categories
				</a>
			</div>
		
			<div class="topbar-button">
				<a href="/links">
					Friends
				</a>
			</div>
		
			<div class="topbar-button">
				<a href="/sites">
					Sites
				</a>
			</div>
		
			<div class="topbar-button">
				<a href="/stars">
					Stars
				</a>
			</div>
		

	</div>
	<div class="slogan">
		「生活可以更简单, 欢迎来到我的开源世界」
	</div>
</header>


<link rel="stylesheet" href="/css/font.css">


<link rel="stylesheet" href="/css/post.css" media="screen and (min-width: 600px)">


<link rel="stylesheet" href="/css/post_mobile.css" media="screen and (max-width: 600px)">


<link rel="stylesheet" href="/css/highlight.css">




<div class="toc">
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#cpp-httplib"><span class="toc-text">cpp-httplib</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Server-%E7%A4%BA%E4%BE%8B"><span class="toc-text">Server 示例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%91%E5%AE%9A%E5%A5%97%E6%8E%A5%E5%AD%97%E5%88%B0%E5%A4%9A%E4%B8%AA%E6%8E%A5%E5%8F%A3ip%E5%9C%B0%E5%9D%80%E5%92%8C%E4%BB%BB%E6%84%8F%E5%8F%AF%E7%94%A8%E7%AB%AF%E5%8F%A3"><span class="toc-text">绑定套接字到多个接口ip地址和任意可用端口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6Server"><span class="toc-text">静态文件Server</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97-Logging"><span class="toc-text">日志 Logging</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-text">错误处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E2%80%99multipart-form-data%E2%80%99-%E4%B8%8A%E4%BC%A0%E6%95%B0%E6%8D%AE"><span class="toc-text">使用’multipart&#x2F;form-data’ 上传数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Content-receiver-%E6%8E%A5%E6%94%B6%E5%86%85%E5%AE%B9"><span class="toc-text">使用Content receiver 接收内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Content-provider-%E6%8F%90%E4%BE%9B%E5%86%85%E5%AE%B9"><span class="toc-text">使用Content provider 提供内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%9D%97%E4%BC%A0%E8%BE%93%E7%BC%96%E7%A0%81"><span class="toc-text">分块传输编码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%80%98Expect-100-continue%E2%80%99-%E5%A4%84%E7%90%86"><span class="toc-text">‘Expect: 100-continue’ 处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E6%B4%BB%E8%BF%9E%E6%8E%A5"><span class="toc-text">存活连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%B6%85%E6%97%B6%E9%99%90%E5%88%B6"><span class="toc-text">设置超时限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AErequest-body%E6%9C%80%E5%A4%A7%E6%8E%A5%E6%94%B6%E7%AA%97%E5%8F%A3"><span class="toc-text">设置request body最大接收窗口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Server-Sent-Events"><span class="toc-text">Server-Sent Events</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Default-thread-pool-support"><span class="toc-text">Default thread pool support</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Override-the-default-thread-pool-with-yours"><span class="toc-text">Override the default thread pool with yours</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Client-%E7%A4%BA%E4%BE%8B"><span class="toc-text">Client 示例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GET-with-HTTP-headers"><span class="toc-text">GET with HTTP headers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#POST"><span class="toc-text">POST</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#POST-with-parameters"><span class="toc-text">POST with parameters</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#POST-with-Multipart-Form-Data"><span class="toc-text">POST with Multipart Form Data</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PUT"><span class="toc-text">PUT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DELETE"><span class="toc-text">DELETE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OPTIONS"><span class="toc-text">OPTIONS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Timeout"><span class="toc-text">Timeout</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Receive-content-with-Content-receiver"><span class="toc-text">Receive content with Content receiver</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Send-content-with-Content-provider"><span class="toc-text">Send content with Content provider</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#With-Progress-Callback"><span class="toc-text">With Progress Callback</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Authentication"><span class="toc-text">Authentication</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Proxy-server-support"><span class="toc-text">Proxy server support</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Range"><span class="toc-text">Range</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Keep-Alive-connection"><span class="toc-text">Keep-Alive connection</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redirect"><span class="toc-text">Redirect</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Use-a-specitic-network-interface"><span class="toc-text">Use a specitic network interface</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OpenSSL-Support"><span class="toc-text">OpenSSL Support</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Compression"><span class="toc-text">Compression</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Zlib-Support"><span class="toc-text">Zlib Support</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Brotli-Support"><span class="toc-text">Brotli Support</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Compress-request-body-on-client"><span class="toc-text">Compress request body on client</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Compress-response-body-on-client"><span class="toc-text">Compress response body on client</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Split-httplib-h-into-h-and-cc"><span class="toc-text">Split httplib.h into .h and .cc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E6%B3%A8%E6%84%8F"><span class="toc-text">编译注意</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#g"><span class="toc-text">g++</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows"><span class="toc-text">Windows</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#License"><span class="toc-text">License</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Special-Thanks-To"><span class="toc-text">Special Thanks To</span></a></li></ol></li></ol>
</div>

<div class="content-area">
	<div class="title">
		httplib库的使用
	</div>
	
	<div class="page-date">
		2020-08-10
	</div>
	
	<div class="category-area">
		
			 
				「
				<div class="category">
					<a href="/categories/C++">C++</a>
				
				</div>
				」
			
		
	</div>
	
	<div class="content">
		<p><a target="_blank" rel="noopener" href="https://github.com/yhirose/cpp-httplib">httplib库的使用。</a></p>
<span id="more"></span>

<h1 id="cpp-httplib"><a href="#cpp-httplib" class="headerlink" title="cpp-httplib"></a>cpp-httplib</h1><p>cpp-httplib是一个跨平台的HTTP/HTTPS库，只有一个头文件，使用C++11新标准编程。</p>
<p>该库方便易用，仅需要在你的程序中引入头文件<code>httplib.h</code>！</p>
<h2 id="Server-示例"><a href="#Server-示例" class="headerlink" title="Server 示例"></a>Server 示例</h2><figure class="highlight c++"><table><tr><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;httplib.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> httplib;<br><br>  Server svr;<br><br>  svr.<span class="hljs-built_in">Get</span>(<span class="hljs-string">&quot;/hi&quot;</span>, [](<span class="hljs-keyword">const</span> Request&amp; req, Response&amp; res) &#123;<br>    res.<span class="hljs-built_in">set_content</span>(<span class="hljs-string">&quot;Hello World!&quot;</span>, <span class="hljs-string">&quot;text/plain&quot;</span>);<br>  &#125;);<br><br>  svr.<span class="hljs-built_in">Get</span>(<span class="hljs-string">R&quot;(/numbers/(\d+))&quot;</span>, [&amp;](<span class="hljs-keyword">const</span> Request&amp; req, Response&amp; res) &#123;<br>    <span class="hljs-keyword">auto</span> numbers = req.matches[<span class="hljs-number">1</span>];<br>    res.<span class="hljs-built_in">set_content</span>(numbers, <span class="hljs-string">&quot;text/plain&quot;</span>);<br>  &#125;);<br><br>  svr.<span class="hljs-built_in">Get</span>(<span class="hljs-string">&quot;/body-header-param&quot;</span>, [](<span class="hljs-keyword">const</span> Request&amp; req, Response&amp; res) &#123;<br>    <span class="hljs-keyword">if</span> (req.<span class="hljs-built_in">has_header</span>(<span class="hljs-string">&quot;Content-Length&quot;</span>)) &#123;<br>      <span class="hljs-keyword">auto</span> val = req.<span class="hljs-built_in">get_header_value</span>(<span class="hljs-string">&quot;Content-Length&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (req.<span class="hljs-built_in">has_param</span>(<span class="hljs-string">&quot;key&quot;</span>)) &#123;<br>      <span class="hljs-keyword">auto</span> val = req.<span class="hljs-built_in">get_param_value</span>(<span class="hljs-string">&quot;key&quot;</span>);<br>    &#125;<br>    res.<span class="hljs-built_in">set_content</span>(req.body, <span class="hljs-string">&quot;text/plain&quot;</span>);<br>  &#125;);<br><br>  svr.<span class="hljs-built_in">Get</span>(<span class="hljs-string">&quot;/stop&quot;</span>, [&amp;](<span class="hljs-keyword">const</span> Request&amp; req, Response&amp; res) &#123;<br>    svr.<span class="hljs-built_in">stop</span>();<br>  &#125;);<br><br>  svr.<span class="hljs-built_in">listen</span>(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">1234</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>除了<code>Get</code>方法，<code>Post</code>、<code>Put</code>、<code>Delete</code>、<code>Options</code>同样被支持。</p>
<h3 id="绑定套接字到多个接口ip地址和任意可用端口"><a href="#绑定套接字到多个接口ip地址和任意可用端口" class="headerlink" title="绑定套接字到多个接口ip地址和任意可用端口"></a>绑定套接字到多个接口ip地址和任意可用端口</h3><figure class="highlight c++"><table><tr><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">int</span> port = svr.<span class="hljs-built_in">bind_to_any_port</span>(<span class="hljs-string">&quot;0.0.0.0&quot;</span>);<br>svr.<span class="hljs-built_in">listen_after_bind</span>();<br></code></pre></td></tr></table></figure>

<h3 id="静态文件Server"><a href="#静态文件Server" class="headerlink" title="静态文件Server"></a>静态文件Server</h3><figure class="highlight c++"><table><tr><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// Mount / to ./www directory</span><br><span class="hljs-keyword">auto</span> ret = svr.<span class="hljs-built_in">set_mount_point</span>(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;./www&quot;</span>);<br><span class="hljs-keyword">if</span> (!ret) &#123;<br>  <span class="hljs-comment">// The specified base directory doesn&#x27;t exist...</span><br>&#125;<br><br><span class="hljs-comment">// Mount /public to ./www directory</span><br>ret = svr.<span class="hljs-built_in">set_mount_point</span>(<span class="hljs-string">&quot;/public&quot;</span>, <span class="hljs-string">&quot;./www&quot;</span>);<br><br><span class="hljs-comment">// Mount /public to ./www1 and ./www2 directories</span><br>ret = svr.<span class="hljs-built_in">set_mount_point</span>(<span class="hljs-string">&quot;/public&quot;</span>, <span class="hljs-string">&quot;./www1&quot;</span>); <span class="hljs-comment">// 1st order to search</span><br>ret = svr.<span class="hljs-built_in">set_mount_point</span>(<span class="hljs-string">&quot;/public&quot;</span>, <span class="hljs-string">&quot;./www2&quot;</span>); <span class="hljs-comment">// 2nd order to search</span><br><br><span class="hljs-comment">// Remove mount /</span><br>ret = svr.<span class="hljs-built_in">remove_mount_point</span>(<span class="hljs-string">&quot;/&quot;</span>);<br><br><span class="hljs-comment">// Remove mount /public</span><br>ret = svr.<span class="hljs-built_in">remove_mount_point</span>(<span class="hljs-string">&quot;/public&quot;</span>);<br></code></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// User defined file extension and MIME type mappings</span><br>svr.<span class="hljs-built_in">set_file_extension_and_mimetype_mapping</span>(<span class="hljs-string">&quot;cc&quot;</span>, <span class="hljs-string">&quot;text/x-c&quot;</span>);<br>svr.<span class="hljs-built_in">set_file_extension_and_mimetype_mapping</span>(<span class="hljs-string">&quot;cpp&quot;</span>, <span class="hljs-string">&quot;text/x-c&quot;</span>);<br>svr.<span class="hljs-built_in">set_file_extension_and_mimetype_mapping</span>(<span class="hljs-string">&quot;hh&quot;</span>, <span class="hljs-string">&quot;text/x-h&quot;</span>);<br></code></pre></td></tr></table></figure>

<p>已经内建映射的文件格式：</p>
<table>
<thead>
<tr>
<th>Extension</th>
<th>MIME Type</th>
</tr>
</thead>
<tbody><tr>
<td>txt</td>
<td>text/plain</td>
</tr>
<tr>
<td>html, htm</td>
<td>text/html</td>
</tr>
<tr>
<td>css</td>
<td>text/css</td>
</tr>
<tr>
<td>jpeg, jpg</td>
<td>image/jpg</td>
</tr>
<tr>
<td>png</td>
<td>image/png</td>
</tr>
<tr>
<td>gif</td>
<td>image/gif</td>
</tr>
<tr>
<td>svg</td>
<td>image/svg+xml</td>
</tr>
<tr>
<td>ico</td>
<td>image/x-icon</td>
</tr>
<tr>
<td>json</td>
<td>application/json</td>
</tr>
<tr>
<td>pdf</td>
<td>application/pdf</td>
</tr>
<tr>
<td>js</td>
<td>application/javascript</td>
</tr>
<tr>
<td>wasm</td>
<td>application/wasm</td>
</tr>
<tr>
<td>xml</td>
<td>application/xml</td>
</tr>
<tr>
<td>xhtml</td>
<td>application/xhtml+xml</td>
</tr>
</tbody></table>
<p>注意：静态文件服务提供的方法并非线程安全的</p>
<h3 id="日志-Logging"><a href="#日志-Logging" class="headerlink" title="日志 Logging"></a>日志 Logging</h3><figure class="highlight c++"><table><tr><td class="code"><pre><code class="hljs c++">svr.<span class="hljs-built_in">set_logger</span>([](<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span>&amp; req, <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span>&amp; res) &#123;<br>  <span class="hljs-built_in">your_logger</span>(req, res);<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><figure class="highlight c++"><table><tr><td class="code"><pre><code class="hljs c++">svr.<span class="hljs-built_in">set_error_handler</span>([](<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span>&amp; req, <span class="hljs-keyword">auto</span>&amp; res) &#123;<br>  <span class="hljs-keyword">auto</span> fmt = <span class="hljs-string">&quot;&lt;p&gt;Error Status: &lt;span style=&#x27;color:red;&#x27;&gt;%d&lt;/span&gt;&lt;/p&gt;&quot;</span>;<br>  <span class="hljs-keyword">char</span> buf[BUFSIZ];<br>  <span class="hljs-built_in">snprintf</span>(buf, <span class="hljs-built_in"><span class="hljs-keyword">sizeof</span></span>(buf), fmt, res.status);<br>  res.<span class="hljs-built_in">set_content</span>(buf, <span class="hljs-string">&quot;text/html&quot;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="使用’multipart-form-data’-上传数据"><a href="#使用’multipart-form-data’-上传数据" class="headerlink" title="使用’multipart/form-data’ 上传数据"></a>使用’multipart/form-data’ 上传数据</h3><figure class="highlight c++"><table><tr><td class="code"><pre><code class="hljs c++">svr.<span class="hljs-built_in">Post</span>(<span class="hljs-string">&quot;/multipart&quot;</span>, [&amp;](<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span>&amp; req, <span class="hljs-keyword">auto</span>&amp; res) &#123;<br>  <span class="hljs-keyword">auto</span> size = req.files.<span class="hljs-built_in">size</span>();<br>  <span class="hljs-keyword">auto</span> ret = req.<span class="hljs-built_in">has_file</span>(<span class="hljs-string">&quot;name1&quot;</span>);<br>  <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span>&amp; file = req.<span class="hljs-built_in">get_file_value</span>(<span class="hljs-string">&quot;name1&quot;</span>);<br>  <span class="hljs-comment">// file.filename;</span><br>  <span class="hljs-comment">// file.content_type;</span><br>  <span class="hljs-comment">// file.content;</span><br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="使用Content-receiver-接收内容"><a href="#使用Content-receiver-接收内容" class="headerlink" title="使用Content receiver 接收内容"></a>使用Content receiver 接收内容</h3><figure class="highlight c++"><table><tr><td class="code"><pre><code class="hljs c++">svr.<span class="hljs-built_in">Post</span>(<span class="hljs-string">&quot;/content_receiver&quot;</span>,<br>  [&amp;](<span class="hljs-keyword">const</span> Request &amp;req, Response &amp;res, <span class="hljs-keyword">const</span> ContentReader &amp;content_reader) &#123;<br>    <span class="hljs-keyword">if</span> (req.<span class="hljs-built_in">is_multipart_form_data</span>()) &#123;<br>      MultipartFormDataItems files;<br>      <span class="hljs-built_in">content_reader</span>(<br>        [&amp;](<span class="hljs-keyword">const</span> MultipartFormData &amp;file) &#123;<br>          files.<span class="hljs-built_in">push_back</span>(file);<br>          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;,<br>        [&amp;](<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *data, <span class="hljs-keyword">size_t</span> data_length) &#123;<br>          files.<span class="hljs-built_in">back</span>().content.<span class="hljs-built_in">append</span>(data, data_length);<br>          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      std::string body;<br>      <span class="hljs-built_in">content_reader</span>([&amp;](<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *data, <span class="hljs-keyword">size_t</span> data_length) &#123;<br>        body.<span class="hljs-built_in">append</span>(data, data_length);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>      &#125;);<br>      res.<span class="hljs-built_in">set_content</span>(body, <span class="hljs-string">&quot;text/plain&quot;</span>);<br>    &#125;<br>  &#125;);<br></code></pre></td></tr></table></figure>

<h3 id="使用Content-provider-提供内容"><a href="#使用Content-provider-提供内容" class="headerlink" title="使用Content provider 提供内容"></a>使用Content provider 提供内容</h3><figure class="highlight c++"><table><tr><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">const</span> <span class="hljs-keyword">size_t</span> DATA_CHUNK_SIZE = <span class="hljs-number">4</span>;<br><br>svr.<span class="hljs-built_in">Get</span>(<span class="hljs-string">&quot;/stream&quot;</span>, [&amp;](<span class="hljs-keyword">const</span> Request &amp;req, Response &amp;res) &#123;<br>  <span class="hljs-keyword">auto</span> data = <span class="hljs-keyword">new</span> std::<span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;abcdefg&quot;</span>);<br><br>  res.<span class="hljs-built_in">set_content_provider</span>(<br>    data-&gt;<span class="hljs-built_in">size</span>(), <span class="hljs-comment">// Content length</span><br>    [data](<span class="hljs-keyword">size_t</span> offset, <span class="hljs-keyword">size_t</span> length, DataSink &amp;sink) &#123;<br>      <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> &amp;d = *data;<br>      sink.<span class="hljs-built_in">write</span>(&amp;d[offset], std::<span class="hljs-built_in">min</span>(length, DATA_CHUNK_SIZE));<br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// return &#x27;false&#x27; if you want to cancel the process.</span><br>    &#125;,<br>    [data] &#123; <span class="hljs-keyword">delete</span> data; &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="分块传输编码"><a href="#分块传输编码" class="headerlink" title="分块传输编码"></a>分块传输编码</h3><figure class="highlight c++"><table><tr><td class="code"><pre><code class="hljs c++">svr.<span class="hljs-built_in">Get</span>(<span class="hljs-string">&quot;/chunked&quot;</span>, [&amp;](<span class="hljs-keyword">const</span> Request&amp; req, Response&amp; res) &#123;<br>  res.<span class="hljs-built_in">set_chunked_content_provider</span>(<br>    [](<span class="hljs-keyword">size_t</span> offset, DataSink &amp;sink) &#123;<br>      sink.<span class="hljs-built_in">write</span>(<span class="hljs-string">&quot;123&quot;</span>, <span class="hljs-number">3</span>);<br>      sink.<span class="hljs-built_in">write</span>(<span class="hljs-string">&quot;345&quot;</span>, <span class="hljs-number">3</span>);<br>      sink.<span class="hljs-built_in">write</span>(<span class="hljs-string">&quot;789&quot;</span>, <span class="hljs-number">3</span>);<br>      sink.<span class="hljs-built_in">done</span>();<br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// return &#x27;false&#x27; if you want to cancel the process.</span><br>    &#125;<br>  );<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="‘Expect-100-continue’-处理"><a href="#‘Expect-100-continue’-处理" class="headerlink" title="‘Expect: 100-continue’ 处理"></a>‘Expect: 100-continue’ 处理</h3><p>默认情况下，server 发送 <code>100 Continue</code> 响应给 <code>Expect: 100-continue</code> header。</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// Send a &#x27;417 Expectation Failed&#x27; response.</span><br>svr.<span class="hljs-built_in">set_expect_100_continue_handler</span>([](<span class="hljs-keyword">const</span> Request &amp;req, Response &amp;res) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">417</span>;<br>&#125;);<br></code></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// Send a final status without reading the message body.</span><br>svr.<span class="hljs-built_in">set_expect_100_continue_handler</span>([](<span class="hljs-keyword">const</span> Request &amp;req, Response &amp;res) &#123;<br>  <span class="hljs-keyword">return</span> res.status = <span class="hljs-number">401</span>;<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="存活连接"><a href="#存活连接" class="headerlink" title="存活连接"></a>存活连接</h3><figure class="highlight c++"><table><tr><td class="code"><pre><code class="hljs c++">svr.<span class="hljs-built_in">set_keep_alive_max_count</span>(<span class="hljs-number">2</span>); <span class="hljs-comment">// Default is 5</span><br></code></pre></td></tr></table></figure>

<h3 id="设置超时限制"><a href="#设置超时限制" class="headerlink" title="设置超时限制"></a>设置超时限制</h3><figure class="highlight c++"><table><tr><td class="code"><pre><code class="hljs c++">svr.<span class="hljs-built_in">set_read_timeout</span>(<span class="hljs-number">5</span>, <span class="hljs-number">0</span>); <span class="hljs-comment">// 5 seconds</span><br>svr.<span class="hljs-built_in">set_write_timeout</span>(<span class="hljs-number">5</span>, <span class="hljs-number">0</span>); <span class="hljs-comment">// 5 seconds</span><br>svr.<span class="hljs-built_in">set_idle_interval</span>(<span class="hljs-number">0</span>, <span class="hljs-number">100000</span>); <span class="hljs-comment">// 100 milliseconds</span><br></code></pre></td></tr></table></figure>

<h3 id="设置request-body最大接收窗口"><a href="#设置request-body最大接收窗口" class="headerlink" title="设置request body最大接收窗口"></a>设置request body最大接收窗口</h3><figure class="highlight c++"><table><tr><td class="code"><pre><code class="hljs c++">svr.<span class="hljs-built_in">set_payload_max_length</span>(<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">512</span>); <span class="hljs-comment">// 512MB</span><br></code></pre></td></tr></table></figure>

<h3 id="Server-Sent-Events"><a href="#Server-Sent-Events" class="headerlink" title="Server-Sent Events"></a>Server-Sent Events</h3><p>Please see <a target="_blank" rel="noopener" href="https://github.com/yhirose/cpp-httplib/blob/master/example/ssesvr.cc">Server example</a> and <a target="_blank" rel="noopener" href="https://github.com/yhirose/cpp-httplib/blob/master/example/ssecli.cc">Client example</a>.</p>
<h3 id="Default-thread-pool-support"><a href="#Default-thread-pool-support" class="headerlink" title="Default thread pool support"></a>Default thread pool support</h3><p><code>ThreadPool</code> is used as a default task queue, and the default thread count is set to value from <code>std::thread::hardware_concurrency()</code>.</p>
<p>You can change the thread count by setting <code>CPPHTTPLIB_THREAD_POOL_COUNT</code>.</p>
<h3 id="Override-the-default-thread-pool-with-yours"><a href="#Override-the-default-thread-pool-with-yours" class="headerlink" title="Override the default thread pool with yours"></a>Override the default thread pool with yours</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">class YourThreadPoolTaskQueue : public TaskQueue &#123;<br>public:<br>  YourThreadPoolTaskQueue(size_t n) &#123;<br>    pool_.start_with_thread_count(n);<br>  &#125;<br><br>  virtual void enqueue(std::function&lt;void()&gt; fn) override &#123;<br>    pool_.enqueue(fn);<br>  &#125;<br><br>  virtual void shutdown() override &#123;<br>    pool_.shutdown_gracefully();<br>  &#125;<br><br>private:<br>  YourThreadPool pool_;<br>&#125;;<br><br>svr.new_task_queue = [] &#123;<br>  return new YourThreadPoolTaskQueue(12);<br>&#125;;<br></code></pre></td></tr></table></figure>

<h2 id="Client-示例"><a href="#Client-示例" class="headerlink" title="Client 示例"></a>Client 示例</h2><figure class="highlight c++"><table><tr><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;httplib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-function">httplib::Client <span class="hljs-title">cli</span><span class="hljs-params">(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">1234</span>)</span></span>;<br><br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">auto</span> res = cli.<span class="hljs-built_in">Get</span>(<span class="hljs-string">&quot;/hi&quot;</span>)) &#123;<br>    <span class="hljs-keyword">if</span> (res-&gt;status == <span class="hljs-number">200</span>) &#123;<br>      std::cout &lt;&lt; res-&gt;body &lt;&lt; std::endl;<br>    &#125;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">auto</span> err = res.<span class="hljs-built_in">error</span>();<br>    <span class="hljs-comment">/*...*/</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>NOTE: Constructor with scheme-host-port string is now supported!</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">httplib::Client cli(&quot;localhost&quot;);<br>httplib::Client cli(&quot;localhost:8080&quot;);<br>httplib::Client cli(&quot;http://localhost&quot;);<br>httplib::Client cli(&quot;http://localhost:8080&quot;);<br>httplib::Client cli(&quot;https://localhost&quot;);<br></code></pre></td></tr></table></figure>

<h3 id="GET-with-HTTP-headers"><a href="#GET-with-HTTP-headers" class="headerlink" title="GET with HTTP headers"></a>GET with HTTP headers</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">httplib::Headers headers = &#123;<br>  &#123; &quot;Accept-Encoding&quot;, &quot;gzip, deflate&quot; &#125;<br>&#125;;<br>auto res = cli.Get(&quot;/hi&quot;, headers);<br></code></pre></td></tr></table></figure>

<p>or</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">cli.set_default_headers(&#123;<br>  &#123; &quot;Accept-Encoding&quot;, &quot;gzip, deflate&quot; &#125;<br>&#125;);<br>auto res = cli.Get(&quot;/hi&quot;);<br></code></pre></td></tr></table></figure>

<h3 id="POST"><a href="#POST" class="headerlink" title="POST"></a>POST</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">res = cli.Post(&quot;/post&quot;, &quot;text&quot;, &quot;text/plain&quot;);<br>res = cli.Post(&quot;/person&quot;, &quot;name=john1&amp;note=coder&quot;, &quot;application/x-www-form-urlencoded&quot;);<br></code></pre></td></tr></table></figure>

<h3 id="POST-with-parameters"><a href="#POST-with-parameters" class="headerlink" title="POST with parameters"></a>POST with parameters</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">httplib::Params params;<br>params.emplace(&quot;name&quot;, &quot;john&quot;);<br>params.emplace(&quot;note&quot;, &quot;coder&quot;);<br><br>auto res = cli.Post(&quot;/post&quot;, params);<br></code></pre></td></tr></table></figure>

<p>or</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">httplib::Params params&#123;<br>  &#123; &quot;name&quot;, &quot;john&quot; &#125;,<br>  &#123; &quot;note&quot;, &quot;coder&quot; &#125;<br>&#125;;<br><br>auto res = cli.Post(&quot;/post&quot;, params);<br></code></pre></td></tr></table></figure>

<h3 id="POST-with-Multipart-Form-Data"><a href="#POST-with-Multipart-Form-Data" class="headerlink" title="POST with Multipart Form Data"></a>POST with Multipart Form Data</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">httplib::MultipartFormDataItems items = &#123;<br>  &#123; &quot;text1&quot;, &quot;text default&quot;, &quot;&quot;, &quot;&quot; &#125;,<br>  &#123; &quot;text2&quot;, &quot;aωb&quot;, &quot;&quot;, &quot;&quot; &#125;,<br>  &#123; &quot;file1&quot;, &quot;h\ne\n\nl\nl\no\n&quot;, &quot;hello.txt&quot;, &quot;text/plain&quot; &#125;,<br>  &#123; &quot;file2&quot;, &quot;&#123;\n  \&quot;world\&quot;, true\n&#125;\n&quot;, &quot;world.json&quot;, &quot;application/json&quot; &#125;,<br>  &#123; &quot;file3&quot;, &quot;&quot;, &quot;&quot;, &quot;application/octet-stream&quot; &#125;,<br>&#125;;<br><br>auto res = cli.Post(&quot;/multipart&quot;, items);<br></code></pre></td></tr></table></figure>

<h3 id="PUT"><a href="#PUT" class="headerlink" title="PUT"></a>PUT</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">res = cli.Put(&quot;/resource/foo&quot;, &quot;text&quot;, &quot;text/plain&quot;);<br></code></pre></td></tr></table></figure>

<h3 id="DELETE"><a href="#DELETE" class="headerlink" title="DELETE"></a>DELETE</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">res = cli.Delete(&quot;/resource/foo&quot;);<br></code></pre></td></tr></table></figure>

<h3 id="OPTIONS"><a href="#OPTIONS" class="headerlink" title="OPTIONS"></a>OPTIONS</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">res = cli.Options(&quot;*&quot;);<br>res = cli.Options(&quot;/resource/foo&quot;);<br></code></pre></td></tr></table></figure>

<h3 id="Timeout"><a href="#Timeout" class="headerlink" title="Timeout"></a>Timeout</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">cli.set_connection_timeout(0, 300000); // 300 milliseconds<br>cli.set_read_timeout(5, 0); // 5 seconds<br>cli.set_write_timeout(5, 0); // 5 seconds<br></code></pre></td></tr></table></figure>

<h3 id="Receive-content-with-Content-receiver"><a href="#Receive-content-with-Content-receiver" class="headerlink" title="Receive content with Content receiver"></a>Receive content with Content receiver</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">std::string body;<br><br>auto res = cli.Get(&quot;/large-data&quot;,<br>  [&amp;](const char *data, size_t data_length) &#123;<br>    body.append(data, data_length);<br>    return true;<br>  &#125;);<br>std::string body;<br><br>auto res = cli.Get(<br>  &quot;/stream&quot;, Headers(),<br>  [&amp;](const Response &amp;response) &#123;<br>    EXPECT_EQ(200, response.status);<br>    return true; // return &#x27;false&#x27; if you want to cancel the request.<br>  &#125;,<br>  [&amp;](const char *data, size_t data_length) &#123;<br>    body.append(data, data_length);<br>    return true; // return &#x27;false&#x27; if you want to cancel the request.<br>  &#125;);<br></code></pre></td></tr></table></figure>

<h3 id="Send-content-with-Content-provider"><a href="#Send-content-with-Content-provider" class="headerlink" title="Send content with Content provider"></a>Send content with Content provider</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">std::string body = ...;<br><br>auto res = cli_.Post(<br>  &quot;/stream&quot;, body.size(),<br>  [](size_t offset, size_t length, DataSink &amp;sink) &#123;<br>    sink.write(body.data() + offset, length);<br>    return true; // return &#x27;false&#x27; if you want to cancel the request.<br>  &#125;,<br>  &quot;text/plain&quot;);<br></code></pre></td></tr></table></figure>

<h3 id="With-Progress-Callback"><a href="#With-Progress-Callback" class="headerlink" title="With Progress Callback"></a>With Progress Callback</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">httplib::Client client(url, port);<br><br>// prints: 0 / 000 bytes =&gt; 50% complete<br>auto res = cli.Get(&quot;/&quot;, [](uint64_t len, uint64_t total) &#123;<br>  printf(&quot;%lld / %lld bytes =&gt; %d%% complete\n&quot;,<br>    len, total,<br>    (int)(len*100/total));<br>  return true; // return &#x27;false&#x27; if you want to cancel the request.<br>&#125;<br>);<br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://user-images.githubusercontent.com/236374/33138910-495c4ecc-cf86-11e7-8693-2fc6d09615c4.gif"><img src="33138910-495c4ecc-cf86-11e7-8693-2fc6d09615c4.gif" alt="progress"></a></p>
<h3 id="Authentication"><a href="#Authentication" class="headerlink" title="Authentication"></a>Authentication</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">// Basic Authentication<br>cli.set_basic_auth(&quot;user&quot;, &quot;pass&quot;);<br><br>// Digest Authentication<br>cli.set_digest_auth(&quot;user&quot;, &quot;pass&quot;);<br><br>// Bearer Token Authentication<br>cli.set_bearer_token_auth(&quot;token&quot;);<br></code></pre></td></tr></table></figure>

<p>NOTE: OpenSSL is required for Digest Authentication.</p>
<h3 id="Proxy-server-support"><a href="#Proxy-server-support" class="headerlink" title="Proxy server support"></a>Proxy server support</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">cli.set_proxy(&quot;host&quot;, port);<br><br>// Basic Authentication<br>cli.set_proxy_basic_auth(&quot;user&quot;, &quot;pass&quot;);<br><br>// Digest Authentication<br>cli.set_proxy_digest_auth(&quot;user&quot;, &quot;pass&quot;);<br><br>// Bearer Token Authentication<br>cli.set_proxy_bearer_token_auth(&quot;pass&quot;);<br></code></pre></td></tr></table></figure>

<p>NOTE: OpenSSL is required for Digest Authentication.</p>
<h3 id="Range"><a href="#Range" class="headerlink" title="Range"></a>Range</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">httplib::Client cli(&quot;httpbin.org&quot;);<br><br>auto res = cli.Get(&quot;/range/32&quot;, &#123;<br>  httplib::make_range_header(&#123;&#123;1, 10&#125;&#125;) // &#x27;Range: bytes=1-10&#x27;<br>&#125;);<br>// res-&gt;status should be 206.<br>// res-&gt;body should be &quot;bcdefghijk&quot;.<br>httplib::make_range_header(&#123;&#123;1, 10&#125;, &#123;20, -1&#125;&#125;)      // &#x27;Range: bytes=1-10, 20-&#x27;<br>httplib::make_range_header(&#123;&#123;100, 199&#125;, &#123;500, 599&#125;&#125;) // &#x27;Range: bytes=100-199, 500-599&#x27;<br>httplib::make_range_header(&#123;&#123;0, 0&#125;, &#123;-1, 1&#125;&#125;)        // &#x27;Range: bytes=0-0, -1&#x27;<br></code></pre></td></tr></table></figure>

<h3 id="Keep-Alive-connection"><a href="#Keep-Alive-connection" class="headerlink" title="Keep-Alive connection"></a>Keep-Alive connection</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">httplib::Client cli(&quot;localhost&quot;, 1234);<br><br>cli.Get(&quot;/hello&quot;);         // with &quot;Connection: close&quot;<br><br>cli.set_keep_alive(true);<br>cli.Get(&quot;/world&quot;);<br><br>cli.set_keep_alive(false);<br>cli.Get(&quot;/last-request&quot;);  // with &quot;Connection: close&quot;<br></code></pre></td></tr></table></figure>

<h3 id="Redirect"><a href="#Redirect" class="headerlink" title="Redirect"></a>Redirect</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">httplib::Client cli(&quot;yahoo.com&quot;);<br><br>auto res = cli.Get(&quot;/&quot;);<br>res-&gt;status; // 301<br><br>cli.set_follow_location(true);<br>res = cli.Get(&quot;/&quot;);<br>res-&gt;status; // 200<br></code></pre></td></tr></table></figure>

<h3 id="Use-a-specitic-network-interface"><a href="#Use-a-specitic-network-interface" class="headerlink" title="Use a specitic network interface"></a>Use a specitic network interface</h3><p>NOTE: This feature is not available on Windows, yet.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">cli.set_interface(&quot;eth0&quot;); // Interface name, IP address or host name<br></code></pre></td></tr></table></figure>

<h2 id="OpenSSL-Support"><a href="#OpenSSL-Support" class="headerlink" title="OpenSSL Support"></a>OpenSSL Support</h2><p>SSL support is available with <code>CPPHTTPLIB_OPENSSL_SUPPORT</code>. <code>libssl</code> and <code>libcrypto</code> should be linked.</p>
<p>NOTE: cpp-httplib currently supports only version 1.1.1.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">#define CPPHTTPLIB_OPENSSL_SUPPORT<br><br>SSLServer svr(&quot;./cert.pem&quot;, &quot;./key.pem&quot;);<br><br>SSLClient cli(&quot;localhost&quot;, 8080);<br>cli.set_ca_cert_path(&quot;./ca-bundle.crt&quot;);<br>cli.enable_server_certificate_verification(true);<br></code></pre></td></tr></table></figure>

<h2 id="Compression"><a href="#Compression" class="headerlink" title="Compression"></a>Compression</h2><p>The server can applie compression to the following MIME type contents:</p>
<ul>
<li>  all text types except text/event-stream</li>
<li>  image/svg+xml</li>
<li>  application/javascript</li>
<li>  application/json</li>
<li>  application/xml</li>
<li>  application/xhtml+xml</li>
</ul>
<h3 id="Zlib-Support"><a href="#Zlib-Support" class="headerlink" title="Zlib Support"></a>Zlib Support</h3><p>‘gzip’ compression is available with <code>CPPHTTPLIB_ZLIB_SUPPORT</code>. <code>libz</code> should be linked.</p>
<h3 id="Brotli-Support"><a href="#Brotli-Support" class="headerlink" title="Brotli Support"></a>Brotli Support</h3><p>Brotli compression is available with <code>CPPHTTPLIB_BROTLI_SUPPORT</code>. Necessary libraries should be linked. Please see <a target="_blank" rel="noopener" href="https://github.com/google/brotli">https://github.com/google/brotli</a> for more detail.</p>
<h3 id="Compress-request-body-on-client"><a href="#Compress-request-body-on-client" class="headerlink" title="Compress request body on client"></a>Compress request body on client</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">cli.set_compress(true);<br>res = cli.Post(&quot;/resource/foo&quot;, &quot;...&quot;, &quot;text/plain&quot;);<br></code></pre></td></tr></table></figure>

<h3 id="Compress-response-body-on-client"><a href="#Compress-response-body-on-client" class="headerlink" title="Compress response body on client"></a>Compress response body on client</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">cli.set_decompress(false);<br>res = cli.Get(&quot;/resource/foo&quot;, &#123;&#123;&quot;Accept-Encoding&quot;, &quot;gzip, deflate, br&quot;&#125;&#125;);<br>res-&gt;body; // Compressed data<br></code></pre></td></tr></table></figure>

<h2 id="Split-httplib-h-into-h-and-cc"><a href="#Split-httplib-h-into-h-and-cc" class="headerlink" title="Split httplib.h into .h and .cc"></a>Split httplib.h into .h and .cc</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">&gt; python3 split.py<br>&gt; ls out<br>httplib.h  httplib.cc<br></code></pre></td></tr></table></figure>

<h2 id="编译注意"><a href="#编译注意" class="headerlink" title="编译注意"></a>编译注意</h2><h3 id="g"><a href="#g" class="headerlink" title="g++"></a>g++</h3><p>由于使用了C++11新标准，g++4.8 以及更旧的版本无法编译成功，因为<code>&lt;regex&gt;</code>库不被支持</p>
<p><strong>编译参数要加上：<code>-pthread</code></strong></p>
<h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><ol>
<li><p>引用 <code>httplib.h</code> 之前先引用<code>Windows.h</code> </p>
 <figure class="highlight c++"><table><tr><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;httplib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Windows.h&gt;</span></span><br></code></pre></td></tr></table></figure></li>
<li><p>先声明<code>WIN32_LEAN_AND_MEAN</code> 再引用<code>Windows.h</code> </p>
 <figure class="highlight c++"><table><tr><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> WIN32_LEAN_AND_MEAN</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Windows.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;httplib.h&gt;</span></span><br></code></pre></td></tr></table></figure></li>
</ol>
<p>注意: Windows下的Cygwin不支持</p>
<h2 id="License"><a href="#License" class="headerlink" title="License"></a>License</h2><p>MIT license (© 2020 Yuji Hirose)</p>
<h2 id="Special-Thanks-To"><a href="#Special-Thanks-To" class="headerlink" title="Special Thanks To"></a>Special Thanks To</h2><p><a target="_blank" rel="noopener" href="https://github.com/yhirose/cpp-httplib/graphs/contributors">These folks</a> made great contributions to polish this library to totally another level from a simple toy!</p>

	</div>
</div>
<!-- 返回顶部模块 -->
<div id="totop" style="position:fixed;bottom:150px;right:50px;cursor: pointer;font-size:26px;background-color:#8590a6">
	<a title="返回顶部" style="color:#04fa9f"><⇧></a>
</div>
<script src="/js/totop.js"></script>

  </body>

</html>