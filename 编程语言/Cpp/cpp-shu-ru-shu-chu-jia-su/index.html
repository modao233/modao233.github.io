<!doctype html><html lang=zh-Hans-CN><head><title>modao's blog</title><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1.0,maximum-scale=1" name=viewport><meta content=noodp name=robots><link href=https://modao.site/style.css rel=stylesheet><link href=https://modao.site/color/green.css rel=stylesheet><link href=https://modao.site/color/background_dark.css rel=stylesheet><link href=https://modao.site/font-hack.css rel=stylesheet><body><div class=container><header class=header><div class=header__inner><div class=header__logo><a style="text-decoration: none;" href=https://modao.site> <div class=logo>MODAO</div> </a></div></div><nav class=menu><ul class=menu__inner><li class=active><a href=https://modao.site>Home</a><li><a href=https://modao.site/tags>Tags</a><li><a href=https://modao.site/language>Programming-Language</a><li><a href=https://modao.site/books>Books</a><li><a href=https://modao.site/links>Links</a><li><a href=https://modao.site/friend>Friend</a><li><a href=https://modao.site/about>About Me</a></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=https://modao.site/编程语言/Cpp/cpp-shu-ru-shu-chu-jia-su/>cpp输入输出加速</a></h1><div class=post-meta-inline><span class=post-date> 2020-01-21 </span></div><div class=post-content><p>用法：<pre class=language-c++ data-lang=c++ style=background-color:#2b303b;color:#c0c5ce;><code class=language-c++ data-lang=c++><span>std::ios::</span><span style=color:#8fa1b3;>sync_with_stdio</span><span>(</span><span style=color:#bf616a;>false</span><span>);
</span><span>std::cin.</span><span style=color:#bf616a;>tie</span><span>(</span><span style=color:#d08770;>nullptr</span><span>);  
</span></code></pre><p>解释：这个函数是一个“是否兼容stdio”的开关，C++为了兼容C，保证程序在使用了std::printf和std::cout的时候不发生混乱，将输出流绑到了一起。<blockquote><p>cin，cout之所以效率低，是因为先把要输出的东西存入缓冲区，再输出，导致效率降低，而这段语句可以来打消iostream的输入输出缓存，可以节省许多时间，使效率与scanf与printf相差无几，还有应注意的是scanf与printf使用的头文件应是stdio.h而不是 iostream。 我们可以在IO之前将stdio解除绑定，这样做了之后要注意不要同时混用cout和printf 之类。</blockquote><p>tie是将两个stream绑定的函数，空参数的话返回当前的输出流指针。 在默认的情况下cin绑定的是cout，每次执行 << 操作符的时候都要调用flush，这样会增加IO负担。可以通过tie(0)（0表示NULL）来解除cin与cout的绑定，进一步加快执行效率。<pre class=language-c++ data-lang=c++ style=background-color:#2b303b;color:#c0c5ce;><code class=language-c++ data-lang=c++><span style=color:#b48ead;>#include </span><span><</span><span style=color:#a3be8c;>iostream</span><span>>
</span><span style=color:#b48ead;>#include </span><span><</span><span style=color:#a3be8c;>fstream</span><span>>
</span><span>
</span><span style=color:#b48ead;>int </span><span style=color:#8fa1b3;>main</span><span>(</span><span style=color:#b48ead;>int </span><span style=color:#bf616a;>argc</span><span>, </span><span style=color:#b48ead;>char </span><span>*</span><span style=color:#bf616a;>argv</span><span>[])
</span><span>{
</span><span>	std::ostream *prevstr;
</span><span>	std::ofstream ofs;
</span><span>	ofs.</span><span style=color:#bf616a;>open</span><span>("</span><span style=color:#a3be8c;>test.txt</span><span>");
</span><span>	std::cout << "</span><span style=color:#a3be8c;>tie example:</span><span style=color:#96b5b4;>\n</span><span>";
</span><span>	</span><span style=color:#65737e;>// 直接输出到屏幕
</span><span>	*std::cin.</span><span style=color:#bf616a;>tie</span><span>() << "</span><span style=color:#a3be8c;>This is inserted into cout</span><span style=color:#96b5b4;>\n</span><span>";
</span><span>	</span><span style=color:#65737e;>// 空参数调用返回默认的output stream，也就是cout
</span><span>	prevstr = std::cin.</span><span style=color:#bf616a;>tie</span><span>(&ofs);
</span><span>	</span><span style=color:#65737e;>// cin绑定ofs，返回原来的output stream
</span><span>	*std::cin.</span><span style=color:#bf616a;>tie</span><span>() << "</span><span style=color:#a3be8c;>This is inserted into the file</span><span style=color:#96b5b4;>\n</span><span>";
</span><span>	</span><span style=color:#65737e;>// ofs，输出到文件
</span><span>	std::cin.</span><span style=color:#bf616a;>tie</span><span>(prevstr);
</span><span>	</span><span style=color:#65737e;>// 恢复
</span><span>	ofs.</span><span style=color:#bf616a;>close</span><span>();
</span><span>	</span><span style=color:#96b5b4;>system</span><span>("</span><span style=color:#a3be8c;>pause</span><span>");
</span><span>	</span><span style=color:#b48ead;>return </span><span style=color:#d08770;>0</span><span>;
</span><span>}
</span></code></pre></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2022 modao</span><span class=copyright-theme> <span class=copyright-theme-sep>:: </span> Theme: <a href=https://github.com/pawroman/zola-theme-terminimal/>Terminimal</a> by pawroman </span></div></div></footer></div>