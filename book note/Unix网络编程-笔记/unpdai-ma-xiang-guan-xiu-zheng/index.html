<!doctype html><html lang=zh-Hans-CN><head><title>modao's blog</title><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1.0,maximum-scale=1" name=viewport><meta content=noodp name=robots><link href=https://modao.site/style.css rel=stylesheet><link href=https://modao.site/color/green.css rel=stylesheet><link href=https://modao.site/color/background_dark.css rel=stylesheet><link href=https://modao.site/font-hack.css rel=stylesheet><body><div class=container><header class=header><div class=header__inner><div class=header__logo><a style="text-decoration: none;" href=https://modao.site> <div class=logo>MODAO</div> </a></div></div><nav class=menu><ul class=menu__inner><li class=active><a href=https://modao.site>Home</a><li><a href=https://modao.site/tags>Tags</a><li><a href=https://modao.site/language>Programming-Language</a><li><a href=https://modao.site/books>Books</a><li><a href=https://modao.site/links>Links</a><li><a href=https://modao.site/friend>Friend</a><li><a href=https://modao.site/about>About Me</a></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href="https://modao.site/book note/Unix网络编程-笔记/unpdai-ma-xiang-guan-xiu-zheng/">unp代码相关修正</a></h1><div class=post-meta-inline><span class=post-date> 2019-12-07 </span></div><div class=post-content><p>unp代码相关修正<h2 id=1>1</h2><pre style=background-color:#2b303b;color:#c0c5ce;><code><span>tcpservpoll01.c:13: error: ‘OPEN_MAX’ undeclared (first use in this function)</span><span>
</span></code></pre><p>OPEN_MAX 在 /usr/inlude/limits.h 已经不存在了<p>猜测：<p><code>/usr/include/linux/fd.h</code>和 <code>/usr/include/linux/limit.h</code>里的 NR_OPEN 就是作者所说的 OPEN_MAX<p>Solution 1： OPEN_MAX --> NR_OPEN， 连 #include 这句都不用更改<p>Solution 2： 在 unp.h 里面手动添加 #define OPEN_MAX 1024， 这个 1024 从上面所说 NR_OPEN 的值得到，<h2 id=2>2</h2><pre style=background-color:#2b303b;color:#c0c5ce;><code><span>tcpservpoll01.c:28: error: ‘POLLRDNORM’ undeclared</span><span>
</span></code></pre><p>原因：<p><del><code>usr/include/sys/poll.h</code>里使用了<code>feature.h</code>，必须在任何使用 feature.h 的文件之前有 #define __XOPEN_SOURCE 的语句</del><p><del>usr/include/sys/poll.h 缺少如下语句：</del><pre style=background-color:#2b303b;color:#c0c5ce;><code><span>#ifdef __USE_XOPEN</span><span>
</span><span>/* These values are defined in XPG4.2.  */</span><span>
</span><span># define POLLRDNORM     0x040           /* Normal data may be read.  */</span><span>
</span><span># define POLLRDBAND     0x080           /* Priority data may be read.  */</span><span>
</span><span># define POLLWRNORM     0x100           /* Writing now will not block.  */</span><span>
</span><span># define POLLWRBAND     0x200           /* Priority data may be written.  */</span><span>
</span><span>#endif</span><span>
</span></code></pre><p>据闻：64位的相关文件里面是有定义的，而32位的Linux里面没有此相关定义。<p>我的poll.h里是有相关定义的，但是引用编译时仍然会报错。<p>Solution ：在 unp.h 里面自己定义这些东西，否则，就是编译内核的时候添加 _XOPEN_SOURCE 选项了<p>我的解决办法：将<code>.c</code>文件改成<code>.cc</code>文件，使用g++编译成功</div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2022 modao</span><span class=copyright-theme> <span class=copyright-theme-sep>:: </span> Theme: <a href=https://github.com/pawroman/zola-theme-terminimal/>Terminimal</a> by pawroman </span></div></div></footer></div>